<!DOCTYPE html>







<html lang="en"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    <!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now">

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="PRE Solutions Series: First Chapter" />
<meta name="author" content="The Archivist" />
<meta property="og:locale" content="en" />
<meta name="description" content="As promised, this is the beginning of our solutions for the book Practical Reverse Engineering I had mentioned earlier. The utmost objective is to solve and provide concrete explanations for each topic." />
<meta property="og:description" content="As promised, this is the beginning of our solutions for the book Practical Reverse Engineering I had mentioned earlier. The utmost objective is to solve and provide concrete explanations for each topic." />
<link rel="canonical" href="https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/" />
<meta property="og:url" content="https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/" />
<meta property="og:site_name" content="Another infosec blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-05T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PRE Solutions Series: First Chapter" />
<meta name="twitter:site" content="@0x7c00" />
<meta name="twitter:creator" content="@The Archivist" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"PRE Solutions Series: First Chapter","url":"https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/","dateModified":"2021-07-05T00:00:00+08:00","datePublished":"2021-07-05T00:00:00+08:00","author":{"@type":"Person","name":"The Archivist"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/"},"description":"As promised, this is the beginning of our solutions for the book Practical Reverse Engineering I had mentioned earlier. The utmost objective is to solve and provide concrete explanations for each topic.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>PRE Solutions Series: First Chapter | Another infosec blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/blog/en/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/blog/en/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/blog/en/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/blog/en/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/blog/en/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Another infosec blog">
<meta name="application-name" content="Another infosec blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/blog/en/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/blog/en/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  

  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/blog/en/" alt="avatar" class="mx-auto">
        
          
          <img src="/blog/en/assets/img/avatar.gif" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/blog/en/">Another infosec blog</a>
    </div>
    <div class="site-subtitle font-italic">Where one's enthusiasm provides knowledge and comprehension for others.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/blog/en/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/blog/en/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/blog/en/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/blog/en/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/blog/en/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/legiahuyy" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/0x7c00" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['legiahuy420','gmail.com'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/blog/en/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/blog/en/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>PRE Solutions Series: First Chapter</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        



<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
    
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- images -->



  <!-- add CDN prefix if it exists -->

  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

  

  <!-- add image placehoder to prevent layout reflow -->

  

  

  
    
      
      
    

    
    

    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      

      

    
      

      
      

      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    
      

      
      

      
      

      

    

    

  

  
  

  

  
  

  




<!-- return -->







<h1 data-toc-skip>PRE Solutions Series: First Chapter</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>
    
    

    

    
    <em>
      
        <a href="https://twitter.com/0x7c00">The Archivist</a>
      
    </em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago"
    date="2021-07-05 00:00:00 +0800"
    
      data-toggle="tooltip"
      data-placement="bottom"
      title="Mon, Jul  5, 2021, 12:00 AM +0800"
    >Jul  5</em>

      </span>

      <!-- lastmod date -->
      
      <span>
        Updated
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago"
    date="2021-7-5"
    
      data-toggle="tooltip"
      data-placement="bottom"
      title="Mon, Jul  5, 2021, 12:00 AM +0800"
    >Jul  5</em>

      </span>
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1077 words">
  <em>5 min</em> read</span>


      <!-- page views -->
      
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>As promised, this is the beginning of our solutions for the book <em>Practical Reverse Engineering</em> I had mentioned earlier. The utmost objective is to solve and provide concrete explanations for each topic.</p>

<!--[READMORE]-->

<p>The target audiences are believed to:</p>

<ul>
  <li>Be familiar with basic mid-level programming language</li>
  <li>Have at least a fundamental understanding of computer architecture (CPU, RAM, etc.)</li>
  <li>Be determined to learn and do exercises in the book</li>
</ul>

<p>And please be noticed that all of these solutions here are explained in <em>my own comprehension and experience</em> as there may have been some miscalculations and inaccuracies therein; hence, readers are recommended to review and reproduce these solutions if possible.</p>

<p>Without further ado, I hope you enjoy the post.</p>

<h2 id="basic-concepts">Basic concepts<a href="#basic-concepts"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Before going any deeper, we have to understand initial concepts about registers, data types, and calling conventions. The book has already covered these definitions in a much more detailed version; it is nonetheless worth going through the vital parts again.</p>

<p>The explanations will be provided in x86 flavor first, then in x64 or ARM to make it easier for beginners.</p>

<h3 id="general-purpose-registers">General Purpose Registers<a href="#general-purpose-registers"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>In protected mode, where virtual memory and paging are supported, the x86 architecture has eight 32-bit general-purpose-registers (GPRs): <code class="language-plaintext highlighter-rouge">EAX, EBX, EDX, ECX, EDI, ESI, EBP, ESP</code>. And some can be further divided into 8- and 16-bit registers such as <code class="language-plaintext highlighter-rouge">AX, AL, SI, DI,...</code>.</p>

<p>The following table presents common GPRs and their general usages:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Register</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ECX</td>
      <td>Loop counter</td>
    </tr>
    <tr>
      <td>EDI</td>
      <td>String-destination operations</td>
    </tr>
    <tr>
      <td>ESI</td>
      <td>String-source operations</td>
    </tr>
    <tr>
      <td>EBP</td>
      <td>Base frame pointer</td>
    </tr>
    <tr>
      <td>ESP</td>
      <td>Stack pointer</td>
    </tr>
    <tr>
      <td>EAX, EBX, EDX</td>
      <td>Computing operations or storing data</td>
    </tr>
  </tbody>
</table></div>

<h3 id="data-types">Data types<a href="#data-types"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>As you may already know,  there are common data types such as <code class="language-plaintext highlighter-rouge">int</code>, <code class="language-plaintext highlighter-rouge">unsigned char</code>, <code class="language-plaintext highlighter-rouge">long</code>, or variable classifications in general. Each of them has a specific size in the memory, which we can evaluate using the <code class="language-plaintext highlighter-rouge">sizeof</code> operator (ex. <code class="language-plaintext highlighter-rouge">sizeof(int) results in 4</code>). This is also applied to our assembly registers without any significant difference.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Data-type</th>
      <th>Size</th>
      <th>Register</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Byte</td>
      <td>8 bits</td>
      <td>AL, CL, BL</td>
    </tr>
    <tr>
      <td>Word</td>
      <td>16 bits</td>
      <td>AX, BX, CX</td>
    </tr>
    <tr>
      <td>Double Word</td>
      <td>32 bits</td>
      <td>EAX, EBX, ECX</td>
    </tr>
    <tr>
      <td>Quad Word</td>
      <td>64 bits</td>
      <td>EDX:EAX</td>
    </tr>
  </tbody>
</table></div>

<p>Speaking in x86, <code class="language-plaintext highlighter-rouge">Qword</code> is not available on this architecture but it can combine two 32-bit registers, usually <code class="language-plaintext highlighter-rouge">EDX:EAX</code>, to contain a 64-bit value in some scenarios.</p>

<h3 id="calling-conventions">Calling conventions<a href="#calling-conventions"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>In C/C++, we have seen some common calling conventions: <code class="language-plaintext highlighter-rouge">__cdecl</code>, <code class="language-plaintext highlighter-rouge">__stdcall</code> or <code class="language-plaintext highlighter-rouge">__fastcall</code>. These so-called conventions are multiple sets of rules dictating how function calls work at the machine level. For example, should parameters be passed through the stack or registers? And should they be passed in left-to-right or right-to-left order?</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th> </th>
      <th>CDECL</th>
      <th>STDCALL</th>
      <th>FASTCALL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Parameters</td>
      <td>right-to-left</td>
      <td>right-to-left</td>
      <td>right-to-left</td>
    </tr>
    <tr>
      <td>Stack</td>
      <td>Caller must clean up the stack after call</td>
      <td>Callee must clean up the stack after call</td>
      <td>Besides the first two parameters, all are on the stack.</td>
    </tr>
    <tr>
      <td>Return</td>
      <td>Stored in EAX</td>
      <td>Stored in EAX</td>
      <td>Stored in EAX</td>
    </tr>
  </tbody>
</table></div>

<h2 id="exercise-1---page-11">Exercise 1 - Page 11<a href="#exercise-1---page-11"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Below is our assignment.</p>

<blockquote>
  <p>This function uses a combination SCAS and STOS to do its work. First, explain what is the type of <code class="language-plaintext highlighter-rouge">[EBP+8]</code> and <code class="language-plaintext highlighter-rouge">[EBP+C]</code> in line 1 and 8, respectively. Next explain what this snippet does.</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>01: 8B 7D 08    mov edi, [ebp+8]
02: 8B D7       mov edx, edi
03: 33 C0       xor eax, eax
04: 83 C9 FF    or ecx, 0FFFFFFFFh
05: F2 AE       repne scasb
06: 83 C1 02    add ecx, 2
07: F7 D9       neg ecx
08: 8A 45 0C    mov al, [ebp+0Ch]
09: 8B AA       mov edi, edx
10: F3 AA       rep stosb
11: 8B C2       mov eax, edx
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">[ebp+8]</code> and <code class="language-plaintext highlighter-rouge">[ebp+0C]</code> are the first and second parameters in the code snippet, respectively. It is assured because the convention will put our parameters on the stack before the <code class="language-plaintext highlighter-rouge">CALL</code> instruction is executed.</p>

<p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/legiahuyy/image-host/main/2021-07-05-PRE-C1/stack.png" alt="Function stack" /></p>

<p>The types of <code class="language-plaintext highlighter-rouge">[ebp+8]</code> and <code class="language-plaintext highlighter-rouge">[ebp+C]</code> are most likely to be determined by the destination registers. In line 1, it is shown that the first parameter <code class="language-plaintext highlighter-rouge">[ebp+8]</code> is stored in <code class="language-plaintext highlighter-rouge">EDI</code>, which is commonly used in string operations and yet in line 8, the 8-bit register <code class="language-plaintext highlighter-rouge">AL</code> stores our second parameter<code class="language-plaintext highlighter-rouge">[ebp+C]</code> as a single byte value, ergo:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">[ebp+8]</code> is of type <code class="language-plaintext highlighter-rouge">char*</code> or null-terminated string</li>
  <li><code class="language-plaintext highlighter-rouge">[ebp+C]</code> is of type <code class="language-plaintext highlighter-rouge">char</code> or a single byte letter</li>
</ul>

<h3 id="snippet-walkthrough">Snippet walkthrough<a href="#snippet-walkthrough"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><code class="language-plaintext highlighter-rouge">01: 8B 7D 08    mov edi, [ebp+8]</code></p>

<p>Simply copy the first parameter into <code class="language-plaintext highlighter-rouge">EDI</code> from the stack.</p>

<p><code class="language-plaintext highlighter-rouge">02: 8B D7       mov edx, edi</code></p>

<p>Make a copy of <code class="language-plaintext highlighter-rouge">EDI</code> into <code class="language-plaintext highlighter-rouge">EDX</code>.</p>

<p><code class="language-plaintext highlighter-rouge">03: 33 C0       xor eax, eax</code></p>

<p>This operation sets <code class="language-plaintext highlighter-rouge">EAX</code> to zero.</p>

<p><code class="language-plaintext highlighter-rouge">04: 83 C9 FF    or ecx, 0FFFFFFFFh</code></p>

<p>Sets <code class="language-plaintext highlighter-rouge">ECX</code> to <code class="language-plaintext highlighter-rouge">0xFFFFFFFF</code> or, basically, <code class="language-plaintext highlighter-rouge">-1</code> in decimal.</p>

<p><code class="language-plaintext highlighter-rouge">05: F2 AE       repne scasb</code></p>

<p><code class="language-plaintext highlighter-rouge">REPNE SCASB</code> instruction repeatedly scans and compares the byte of the accumulator (i.e. <code class="language-plaintext highlighter-rouge">EAX</code>) against the present value pointed at by <code class="language-plaintext highlighter-rouge">EDI</code>. It also decreases the counter <code class="language-plaintext highlighter-rouge">ECX</code> and increases <code class="language-plaintext highlighter-rouge">EDI</code> by one each in comparison.</p>

<p>In simple terms, the mentioned instruction searches for the <code class="language-plaintext highlighter-rouge">NUL</code> character in our string buffer. Please do remember that <code class="language-plaintext highlighter-rouge">ECX</code> contains the length of our string plus two (incl. the <code class="language-plaintext highlighter-rouge">NUL</code> byte and an uninitialized/unknown element after it) in negative form. For instance, if our string was 100 characters in length, <code class="language-plaintext highlighter-rouge">ECX</code> would be <code class="language-plaintext highlighter-rouge">-102</code>.</p>

<p><code class="language-plaintext highlighter-rouge">06: 83 C1 02    add ecx, 2</code></p>

<p>Add 2 to <code class="language-plaintext highlighter-rouge">ECX</code> and thus equal to the length of our string in the negative (incl. the <code class="language-plaintext highlighter-rouge">NUL</code> character).</p>

<p><code class="language-plaintext highlighter-rouge">07: F7 D9       neg ecx</code></p>

<p>Negates the value of <code class="language-plaintext highlighter-rouge">ECX</code>, so it is two’s complement negation. <code class="language-plaintext highlighter-rouge">ECX = -(-100) = 100</code>.</p>

<p><code class="language-plaintext highlighter-rouge">08: 8A 45 0C    mov al, [ebp+0Ch]</code></p>

<p>Copy the second parameter to <code class="language-plaintext highlighter-rouge">AL</code> register.</p>

<p><code class="language-plaintext highlighter-rouge">09: 8B AA       mov edi, edx</code></p>

<p>As <code class="language-plaintext highlighter-rouge">EDI</code> was modified (increased in line 5), thereafter the register no longer points at the string buffer. Thus, this resets <code class="language-plaintext highlighter-rouge">EDI</code> with the copied version of itself, <code class="language-plaintext highlighter-rouge">EDX</code>, in line 2 so that it can be used again in the following line.</p>

<p><code class="language-plaintext highlighter-rouge">10: F3 AA       rep stosb</code></p>

<p><code class="language-plaintext highlighter-rouge">STOSB</code> is mostly the same as <code class="language-plaintext highlighter-rouge">SCASB</code> except that it writes the value of the accumulator (i.e. <code class="language-plaintext highlighter-rouge">AL</code>), repeatedly <code class="language-plaintext highlighter-rouge">ECX</code> times, to <code class="language-plaintext highlighter-rouge">EDI</code>. On that account, line 10 instruction replaces our entire buffer with the value of the second parameter.</p>

<p><code class="language-plaintext highlighter-rouge">11: 8B C2       mov eax, edx</code></p>

<p><code class="language-plaintext highlighter-rouge">EAX</code> is now holding the address of our modified string buffer.</p>

<h3 id="pseudo-c-code">Pseudo-C code<a href="#pseudo-c-code"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>The following snippet demonstrates the function.</p>

<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kt">char</span> <span class="o">*</span> <span class="nf">exercise1_page11</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">char</span> <span class="n">param2</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="c1">// get the length of param1</span>
  <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">param1</span><span class="p">);</span>
  <span class="c1">// replace each character in the buffer with param2</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">param1</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>


</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/blog/en/categories/practical-reverse-engineering/'>Practical-Reverse-Engineering</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/blog/en/tags/reverse-engineer/"
          class="post-tag no-text-decoration" >reverse engineer</a>
      
      <a href="/blog/en/tags/practical-reverse-engineering/"
          class="post-tag no-text-decoration" >Practical Reverse Engineering</a>
      
      <a href="/blog/en/tags/on-going/"
          class="post-tag no-text-decoration" >On-going</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=PRE Solutions Series: First Chapter - Another infosec blog&url=https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=PRE Solutions Series: First Chapter - Another infosec blog&u=https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=PRE Solutions Series: First Chapter - Another infosec blog&url=https://legiahuyy.github.io/blog/en/posts/PRE-C1-E1/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recent Update</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/blog/en/posts/pwns-1/">PWN Journey - Part 1</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/HTB-BountyHunter/">HackTheBox - BountyHunter</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/HTB-Cap/">HackTheBox - Cap</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/PRE-C1-E1/">PRE Solutions Series: First Chapter</a></li>
      
        
        
        
      <li><a href="/blog/en/posts/Update-Note/">Update.txt</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/blog/en/tags/pwn/">pwn</a>
    
      
      <a class="post-tag" href="/blog/en/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/blog/en/tags/network/">network</a>
    
      
      <a class="post-tag" href="/blog/en/tags/reverse-engineer/">reverse engineer</a>
    
      
      <a class="post-tag" href="/blog/en/tags/kma/">kma</a>
    
      
      <a class="post-tag" href="/blog/en/tags/machine/">machine</a>
    
      
      <a class="post-tag" href="/blog/en/tags/content/">content</a>
    
      
      <a class="post-tag" href="/blog/en/tags/google-analytics/">google analytics</a>
    
      
      <a class="post-tag" href="/blog/en/tags/miscs/">miscs</a>
    
      
      <a class="post-tag" href="/blog/en/tags/on-going/">On-going</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
      
        
        <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->




  
    
    
      
      
    
  
    
    
      
      
        
        
        
          





  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/blog/en/posts/ez-bof/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2021-02-24 03:45:00 +0800"
    >Feb 24</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>KCSC - A simple BOF</h3>
            <div class="text-muted small">
              <p>
                





                Today we are going to test out Ghidra with one of my university pwnie challenge.


  
    
      Info
      Value
    
  
  
    
      Name
      pwn1
    
    
      SHA256
      d3e77076e7c9c113...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/blog/en/posts/pwns-1/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2021-12-08 00:00:00 +0800"
    >Dec  8</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>PWN Journey - Part 1</h3>
            <div class="text-muted small">
              <p>
                





                Foreword

Greetings, this series of posts delves into a collection of pwnie solutions that I have been poking around for a while and finally have the time to publish it so that I could practice my ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/blog/en/posts/HTB-BountyHunter/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2021-10-03 00:00:00 +0800"
    >Oct  3</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - BountyHunter</h3>
            <div class="text-muted small">
              <p>
                





                Today, we are delving into BountyHunter as another HackTheBox machine in our sidetrack series.

I hope you have a nice weekend and without further ado, let us jump right in!

Enumeration

Nmap outp...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


      
        
        <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/blog/en/posts/Update-Note/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Update.txt</p>
  </a>
  

  
  <a href="/blog/en/posts/HTB-Cap/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>HackTheBox - Cap</p>
  </a>
  

</div>

      
        
        <!--
  The Disqus lazy loading.
-->



      
    </div>
  </div>
</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://twitter.com/0x7c00">The Archivist</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Most rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by Github Pages and Jekyll.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/blog/en/tags/pwn/">pwn</a>
    
      
      <a class="post-tag" href="/blog/en/tags/hackthebox/">hackthebox</a>
    
      
      <a class="post-tag" href="/blog/en/tags/network/">network</a>
    
      
      <a class="post-tag" href="/blog/en/tags/reverse-engineer/">reverse engineer</a>
    
      
      <a class="post-tag" href="/blog/en/tags/kma/">kma</a>
    
      
      <a class="post-tag" href="/blog/en/tags/machine/">machine</a>
    
      
      <a class="post-tag" href="/blog/en/tags/content/">content</a>
    
      
      <a class="post-tag" href="/blog/en/tags/google-analytics/">google analytics</a>
    
      
      <a class="post-tag" href="/blog/en/tags/miscs/">miscs</a>
    
      
      <a class="post-tag" href="/blog/en/tags/on-going/">On-going</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/blog/en/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>





<script defer src="/blog/en/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

